{#
  HTMX Search Results Component

  Displays search results in a dropdown format
  Used by the global search functionality

  Variables:
  - results: List of search result objects with id, type, title, subtitle, url
  - query: The search query string
  - mode: 'modal' for opening modals, 'select' for selecting entities
  - field_name: Name of the field for selection mode
#}
{% from 'macros/ui.html' import icon, entity_badge %}

{% if results %}
    {% if query %}
    <div class="px-4 py-2 text-xs font-medium text-gray-600 bg-gray-50 border-b">
        {{ results|length }} result{% if results|length != 1 %}s{% endif %} for "{{ query }}"
    </div>
    {% endif %}

    {% for result in results %}
    <div class="border-b border-gray-100 last:border-b-0 py-1" data-search-result="{{ result.type }}">
        <a href="#"
           {% if mode == 'select' %}
               {% if result.type == 'choice' or result.type == 'task_field' or result.type == 'assignment' %}
                   onclick="selectChoice('{{ field_name }}', '{{ result.id }}', '{{ result.title }}'); return false;"
               {% else %}
                   onclick="selectEntity('{{ field_name }}', '{{ result.id }}', '{{ result.title }}', '{{ result.type }}'); return false;"
               {% endif %}
           {% else %}
               hx-get="{{ url_for('modals.entity_modal', model_name=result.type, entity_id=result.id, mode='view') }}"
               hx-target="#modal-container"
               hx-swap="innerHTML"
           {% endif %}
           class="flex items-center space-x-3 px-4 py-3 block hover:bg-blue-50 transition-colors duration-150"
           data-entity-type="{{ result.model_type if result.model_type else result.type }}"
           data-entity-id="{{ result.id }}">
            <!-- Type icon -->
            <div class="flex-shrink-0">
                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-sm
                    {% if result.type == 'company' %}bg-blue-100 text-blue-600
                    {% elif result.type == 'stakeholder' %}bg-green-100 text-green-600
                    {% elif result.type == 'opportunity' %}bg-purple-100 text-purple-600
                    {% elif result.type == 'task' %}bg-orange-100 text-orange-600
                    {% elif result.type == 'user' %}bg-indigo-100 text-indigo-600
                    {% elif result.type == 'note' %}bg-yellow-100 text-yellow-600
                    {% elif result.type == 'choice' %}bg-gray-100 text-gray-600
                    {% else %}bg-gray-100 text-gray-600{% endif %}">
                    {{ result.icon if result.icon else 'üìÑ' }}
                </span>
            </div>

            <!-- Content -->
            <div class="min-w-0 flex-1">
                <div class="text-sm font-semibold text-gray-900 break-words hover:text-blue-700 transition-colors">
                    {{ result.title }}
                </div>
                {% if result.subtitle or result.description %}
                <div class="text-xs text-gray-500 break-words mt-1">
                    {{ result.subtitle if result.subtitle else result.description }}
                </div>
                {% endif %}
            </div>

            <!-- Type label -->
            <div class="flex-shrink-0">
                {% if result.type != 'choice' %}
                    {{ entity_badge(result.type) }}
                {% else %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                        choice
                    </span>
                {% endif %}
            </div>
        </a>
    </div>
    {% endfor %}
{% else %}
    <div class="px-4 py-6 text-sm text-gray-500 text-center">
        <div class="text-gray-400 text-2xl mb-2">üîç</div>
        No results found{% if query %} for "{{ query }}"{% endif %}
    </div>
{% endif %}

{# JavaScript functions moved to search-widget.js for DRY implementation #}