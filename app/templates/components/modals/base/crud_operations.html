{% macro crud_operations_js(entity_type, api_endpoint) %}
async save{{ entity_type|title }}Details() {
    if (!this.{{ entity_type|lower }}) return;
    this.saving = true;
    
    try {
        const response = await fetch(`{{ api_endpoint }}/${this.{{ entity_type|lower }}Id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(this.{{ entity_type|lower }})
        });
        
        if (response.ok) {
            this.show = false;
            // Refresh the page or update data
            window.location.reload();
        } else {
            console.error('Failed to save {{ entity_type|lower }} details');
        }
    } catch (error) {
        console.error('Error saving {{ entity_type|lower }} details:', error);
    } finally {
        this.saving = false;
    }
},

async load{{ entity_type|title }}Details(id) {
    if (!id) return;
    this.loading = true;
    this.{{ entity_type|lower }}Id = id;
    
    try {
        const [{{ entity_type|lower }}Response, notesResponse] = await Promise.all([
            fetch(`{{ api_endpoint }}/${id}`),
            fetch(`/api/{{ entity_type|lower }}s/${id}/notes`)
        ]);
        
        if ({{ entity_type|lower }}Response.ok) {
            this.{{ entity_type|lower }} = await {{ entity_type|lower }}Response.json();
        }
        
        if (notesResponse.ok) {
            this.notes = await notesResponse.json();
        }
    } catch (error) {
        console.error('Error loading {{ entity_type|lower }} details:', error);
    } finally {
        this.loading = false;
    }
}
{% endmacro %}

{% macro notes_operations_js(entity_type) %}
async addNote() {
    if (!this.newNote.trim() || !this.{{ entity_type|lower }}Id) return;
    
    try {
        const response = await fetch(`/api/{{ entity_type|lower }}s/${this.{{ entity_type|lower }}Id}/notes`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: this.newNote })
        });
        
        if (response.ok) {
            const note = await response.json();
            this.notes.push(note);
            this.newNote = '';
        }
    } catch (error) {
        console.error('Error adding note:', error);
    }
},

async deleteNote(noteId) {
    try {
        const response = await fetch(`/api/notes/${noteId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            this.notes = this.notes.filter(note => note.id !== noteId);
        }
    } catch (error) {
        console.error('Error deleting note:', error);
    }
}
{% endmacro %}