{% from 'macros/modals/base.html' import htmx_modal_overlay, htmx_modal_header %}
{% from 'macros/modals/footers.html' import render_view_footer, render_form_footer %}
{% from 'macros/widgets/search.html' import search_widget %}
{% from 'macros/base/forms.html' import render_wtforms_field %}

{% call htmx_modal_overlay(max_width="max-w-lg") %}
  {{ htmx_modal_header(modal_title, model_name) }}

  {% if mode == 'view' or is_view %}
    {# View Mode - Read Only #}
    <div id="modal-content-area" class="p-6 space-y-4 bg-white">
      {% for field in form %}
        {% if field.name in ['entity', 'name', 'industry', 'comments'] %}
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">{{ field.label.text }}</label>
            <div class="p-2 bg-gray-50 rounded-md border border-gray-200 text-sm text-gray-900">
              {{ field.data or 'Not set' }}
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    {{ render_view_footer(model_name, entity_id) }}

  {% else %}
    {# Form Mode - Create/Edit #}
    <form method="POST"
          action="{{ action_url }}"
          hx-post="{{ action_url }}"
          hx-target=".modal-overlay"
          hx-swap="outerHTML"
          class="modal-form"
          id="modal-form">

      {{ form.hidden_tag() }}

      <div id="modal-content-area" class="p-6 space-y-4 bg-white">
        {% if form.entity %}
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">{{ form.entity.label.text }}</label>
          {{ search_widget(form.entity) }}
        </div>
        {% endif %}

        {% if form.name %}
        <div class="space-y-2">
          {{ render_wtforms_field(form.name) }}
        </div>
        {% endif %}

        {% if form.industry %}
        <div class="space-y-2">
          {{ render_wtforms_field(form.industry, fast_select=true) }}
        </div>
        {% endif %}

        {% if form.comments %}
        <div class="space-y-2">
          {{ render_wtforms_field(form.comments) }}
        </div>
        {% endif %}
      </div>

      {{ render_form_footer() }}
    </form>
  {% endif %}
{% endcall %}

<script type="module" src="{{ url_for('static', filename='js/features/modal-validation.js') }}"></script>