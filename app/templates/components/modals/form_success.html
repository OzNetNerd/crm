{% from 'macros/ui.html' import icon %}
{#
Form Success Modal Template - Success message after form submission
Shows success and auto-closes or allows manual close
#}

<div class="modal"
     x-data="{
         open: true,
         dragPosition: { x: 0, y: 0 },
         close() {
             if (window.ModalDraggable) {
                 const modalContent = document.querySelector('#success-modal .modal-content');
                 if (modalContent) window.ModalDraggable.resetModalPosition(modalContent);
             }
             this.open = false;
             // Close the modal
             htmx.ajax('GET', '/modals/close', {target: '#modal-container', swap: 'innerHTML'});

             {% if deleted_entity_id %}
             // Immediately remove the deleted entity from the DOM
             const deletedElement = document.getElementById('{{ deleted_entity_id }}');
             if (deletedElement) {
                 deletedElement.style.transition = 'opacity 0.3s ease-out';
                 deletedElement.style.opacity = '0';
                 setTimeout(() => {
                     deletedElement.remove();
                 }, 300);
             }
             {% endif %}

             // Refresh the content to show updated entities
             {% if refresh_url %}
             htmx.ajax('GET', '{{ refresh_url }}', {target: '#entity-content', swap: 'innerHTML'});
             {% endif %}
         }
     }"
     x-show="open"
     id="success-modal">

    <div class="modal-backdrop" @click="close()"></div>

    <div class="modal-content modal-content-sm">
        <!-- Header -->
        <div class="modal-header modal-header-success">
            <h3 class="modal-title">
                {{ icon('check-circle', size='5', class='inline-block mr-2 text-green-500') }}
                Success
            </h3>
            <button type="button"
                    class="modal-close"
                    hx-get="/modals/close"
                    hx-swap="outerHTML"
                    hx-target="#success-modal">
                {{ icon('x-mark') }}
            </button>
        </div>

        <!-- Body -->
        <div class="modal-body">
            <div class="modal-message modal-message-success">
                <p>{{ message|safe }}</p>
                {% if entity %}
                <div class="mt-4 p-3 bg-gray-50 rounded-md">
                    <p class="text-sm text-gray-600">
                        ID: {{ entity.id }}<br>
                        {% if entity.name %}Name: {{ entity.name }}{% endif %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
            <button type="button"
                    class="btn btn-primary"
                    @click="close()">
                OK
            </button>
        </div>
    </div>
</div>