{% from "components/modals/base/modal_base.html" import base_modal, modal_header, modal_footer %}
{% from "components/modals/base/notes_section.html" import notes_section %}
{% from "components/modals/base/crud_operations.html" import crud_operations_js, notes_operations_js %}

<div x-data="{
        show: false,
        taskId: null,
        loading: false,
        saving: false,
        task: {
            description: '',
            due_date: '',
            priority: 'medium',
            next_step_type: '',
            status: 'pending'
        },
        notes: [],
        newNote: '',
        
        {{ crud_operations_js('task', '/api/tasks') }},
        {{ notes_operations_js('task') }},
        
        async loadTask(id) {
            await this.loadTaskDetails(id);
            this.show = true;
        }
     }" 
     @open-task-detail-modal.window="loadTask($event.detail.taskId)"
     @close-modal.window="show = false">

    {% call base_modal('task-detail-modal') %}
        {{ modal_header('Task Details') }}
        
        <div x-show="loading" class="text-center py-4">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        </div>
        
        <div x-show="!loading && task" class="space-y-4">
            <div>
                <label class="text-form-label">Description</label>
                <textarea x-model="task.description" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          rows="3"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-form-label">Due Date</label>
                    <input type="date" x-model="task.due_date" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="text-form-label">Priority</label>
                    <select x-model="task.priority" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label class="text-form-label">Next Step Type</label>
                <select x-model="task.next_step_type" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">None</option>
                    <option value="call">Call</option>
                    <option value="email">Email</option>
                    <option value="meeting">Meeting</option>
                    <option value="demo">Demo</option>
                </select>
            </div>

            <div>
                <label class="text-form-label">Status</label>
                <select x-model="task.status" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="complete">Complete</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            
            {{ notes_section('task') }}
        </div>
        
        {{ modal_footer(save_action="saveTaskDetails()", save_text="Save Changes") }}
    {% endcall %}
</div>