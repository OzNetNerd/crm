{% from "components/icons.html" import check_icon %}
{% from "components/list_section.html" import status_badge %}
{% macro render_task(task) %}
<div class="task-card bg-white rounded-lg shadow-sm border p-4 mb-3" 
     x-data="{ editing: false, description: '{{ task.description }}' }">
    
    <!-- Priority indicator -->
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center space-x-2">
            {% set priority_color = 'red' if task.priority == 'high' else
                                  'yellow' if task.priority == 'medium' else
                                  'green' %}
            {{ status_badge(task.priority, priority_color) }}
            {% if task.is_overdue %}
                <span class="text-badge-overdue">OVERDUE</span>
            {% endif %}
        </div>
        
        <!-- Quick actions -->
        <div class="flex items-center space-x-2">
            <button onclick="completeTask({{ task.id }})" 
                    class="text-success-hover text-action-sm">
                {{ check_icon("w-4 h-4") }}
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 1)" 
                    class="text-info-hover text-action-sm" title="Reschedule +1 day">
                +1d
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 7)" 
                    class="text-info-hover text-action-sm" title="Reschedule +1 week">
                +1w
            </button>
            <button onclick="deleteTask({{ task.id }})" 
                    class="text-danger-hover text-action-sm">
                ×
            </button>
        </div>
    </div>

    <!-- Task description (inline editable) -->
    <div x-show="!editing" @click="editing = true" class="cursor-pointer mb-2">
        <p class="text-label-primary">{{ task.description }}</p>
    </div>
    
    <div x-show="editing" class="mb-2">
        <input x-model="description" 
               @keydown.enter="updateTask({{ task.id }}, { description }); editing = false"
               @keydown.escape="editing = false; description = '{{ task.description }}'"
               @blur="editing = false"
               x-ref="editInput"
               x-init="$nextTick(() => editing && $refs.editInput.focus())"
               class="w-full px-3 py-2 border border-gray-300 rounded-md text-action-sm">
    </div>

    <!-- Task metadata -->
    <div class="flex items-center justify-between">
        <div class="text-metadata">
            {% if task.due_date %}Due: {{ task.due_date.strftime('%d/%m/%y') }}{% endif %}{% if task.due_date and task.entity_name %} • {% endif %}{% if task.entity_name %}{{ task.entity_name }}{% endif %}{% if task.next_step_type and (task.due_date or task.entity_name) %} • {% endif %}{% if task.next_step_type %}{{ task.next_step_type }}{% endif %}
        </div>
        
        <button onclick="openTaskModal({{ task.id }})" 
                class="text-link-subtle">
            Details →
        </button>
    </div>
</div>
{% endmacro %}