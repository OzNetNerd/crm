{% from "components/icons.html" import check_icon %}
{% macro render_task(task) %}
<div class="task-card bg-white rounded-lg shadow-sm border p-4 mb-3" 
     x-data="{ editing: false, description: '{{ task.description }}' }">
    
    <!-- Priority indicator -->
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center space-x-2">
            <span class="priority-badge 
                {{ 'bg-red-100 text-red-800' if task.priority == 'high' else
                   'bg-yellow-100 text-yellow-800' if task.priority == 'medium' else
                   'bg-green-100 text-green-800' }} 
                px-2 py-1 text-xs font-medium rounded-full">
                {{ task.priority|upper }}
            </span>
            {% if task.is_overdue %}
                <span class="text-red-600 text-xs font-medium">OVERDUE</span>
            {% endif %}
        </div>
        
        <!-- Quick actions -->
        <div class="flex items-center space-x-2">
            <button onclick="completeTask({{ task.id }})" 
                    class="text-green-600 hover:text-green-800 text-sm">
                {{ check_icon("w-4 h-4") }}
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 1)" 
                    class="text-blue-600 hover:text-blue-800 text-sm" title="Reschedule +1 day">
                +1d
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 7)" 
                    class="text-blue-600 hover:text-blue-800 text-sm" title="Reschedule +1 week">
                +1w
            </button>
            <button onclick="deleteTask({{ task.id }})" 
                    class="text-red-600 hover:text-red-800 text-sm">
                ×
            </button>
        </div>
    </div>

    <!-- Task description (inline editable) -->
    <div x-show="!editing" @click="editing = true" class="cursor-pointer mb-2">
        <p class="text-gray-900 font-medium">{{ task.description }}</p>
    </div>
    
    <div x-show="editing" class="mb-2">
        <input x-model="description" 
               @keydown.enter="updateTask({{ task.id }}, { description }); editing = false"
               @keydown.escape="editing = false; description = '{{ task.description }}'"
               @blur="editing = false"
               x-ref="editInput"
               x-init="$nextTick(() => editing && $refs.editInput.focus())"
               class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
    </div>

    <!-- Task metadata -->
    <div class="flex items-center justify-between text-sm text-gray-500">
        <div class="flex items-center space-x-4">
            {% if task.due_date %}
                <span class="{{ 'text-red-600 font-medium' if task.is_overdue else 'text-gray-600' }}">
                    Due: {{ task.due_date.strftime('%m/%d') }}
                </span>
            {% endif %}
            
            {% if task.entity_name %}
                <span class="text-blue-600">{{ task.entity_name }}</span>
            {% endif %}
            
            {% if task.next_step_type %}
                <span class="bg-gray-100 text-gray-700 px-2 py-1 text-xs rounded">
                    {{ task.next_step_type }}
                </span>
            {% endif %}
        </div>
        
        <button onclick="openTaskModal({{ task.id }})" 
                class="text-gray-400 hover:text-gray-600">
            Details →
        </button>
    </div>
</div>
{% endmacro %}