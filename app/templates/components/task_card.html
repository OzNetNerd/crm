{% from "components/icons.html" import check_icon %}
{% from "components/list_section.html" import status_badge %}
{% macro render_task(task) %}
<div class="task-card bg-white rounded-lg shadow-sm border p-4 mb-3" 
     data-task-id="{{ task.id }}"
     x-data="{ editing: false, description: '{{ task.description }}' }">
    
    <!-- Priority indicator -->
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center space-x-2">
            {% set priority_color = 'red' if task.priority == 'high' else
                                  'yellow' if task.priority == 'medium' else
                                  'green' %}
            {{ status_badge(task.priority, priority_color) }}
            {% if task.is_overdue %}
                <span class="text-badge-overdue">OVERDUE</span>
            {% endif %}
        </div>
        
        <!-- Quick actions -->
        <div class="flex items-center space-x-1">
            <button onclick="completeTask({{ task.id }})" 
                    class="px-2 py-1 rounded text-success-hover text-action-sm hover:bg-green-50 transition-colors duration-200" 
                    title="Complete task">
                {{ check_icon("w-4 h-4") }}
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 1)" 
                    class="px-2 py-1 rounded text-info-hover text-action-sm hover:bg-blue-50 transition-colors duration-200" 
                    title="Reschedule +1 day">
                +1d
            </button>
            <button onclick="rescheduleTask({{ task.id }}, 7)" 
                    class="px-2 py-1 rounded text-info-hover text-action-sm hover:bg-blue-50 transition-colors duration-200" 
                    title="Reschedule +1 week">
                +1w
            </button>
            <button onclick="deleteTask({{ task.id }})" 
                    class="px-2 py-1 rounded text-danger-hover text-action-sm hover:bg-red-50 transition-colors duration-200" 
                    title="Delete task">
                ×
            </button>
        </div>
    </div>

    <!-- Task description (inline editable) -->
    <div x-show="!editing" @click="editing = true" class="cursor-pointer mb-2">
        <p class="text-label-primary">{{ task.description }}</p>
    </div>
    
    <div x-show="editing" class="mb-2">
        <input x-model="description" 
               @keydown.enter="updateTask({{ task.id }}, { description }); editing = false"
               @keydown.escape="editing = false; description = '{{ task.description }}'"
               @blur="editing = false"
               x-ref="editInput"
               x-init="$nextTick(() => editing && $refs.editInput.focus())"
               class="w-full px-3 py-2 border border-gray-300 rounded-md text-action-sm">
    </div>

    <!-- Task metadata -->
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
            <div class="text-metadata">
                {% if task.due_date %}
                    Due: {{ task.due_date.strftime('%d/%m/%y') }}
                    {% if task.is_overdue %}
                        • {{ (task.due_date.today() - task.due_date).days }} day{{ 's' if (task.due_date.today() - task.due_date).days != 1 else '' }} ago
                    {% elif task.due_date > task.due_date.today() %}
                        • {{ (task.due_date - task.due_date.today()).days }} day{{ 's' if (task.due_date - task.due_date.today()).days != 1 else '' }} to go
                    {% endif %}
                {% endif %}
                {% if task.due_date and task.entity_name %} • {% endif %}
                {% if task.entity_name %}{{ task.entity_name }}{% endif %}
            </div>
            {% if task.next_step_type %}
                <span class="text-badge-tag">{{ task.next_step_type }}</span>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}