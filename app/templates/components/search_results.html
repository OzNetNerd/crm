{#
  HTMX Search Results Component

  Displays search results in a dropdown format
  Used by the global search functionality

  Variables:
  - results: List of search result objects with id, type, title, subtitle, url
  - query: The search query string
#}
{% from 'macros/base/buttons.html' import entity_link %}

{% if results %}
<div class="py-1">
    {% if query %}
    <div class="px-4 py-2 text-xs font-medium text-gray-600 bg-gray-50 border-b">
        {{ results|length }} result{% if results|length != 1 %}s{% endif %} for "{{ query }}"
    </div>
    {% endif %}

    {% for result in results %}
    <div class="border-b border-gray-100 last:border-b-0" data-search-result="{{ result.type }}">
        <div class="flex items-center space-x-3 px-4 py-3">
            <!-- Type icon -->
            <div class="flex-shrink-0">
                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-sm
                    {% if result.type == 'company' %}bg-blue-100 text-blue-600
                    {% elif result.type == 'contact' %}bg-green-100 text-green-600
                    {% elif result.type == 'opportunity' %}bg-purple-100 text-purple-600
                    {% elif result.type == 'task' %}bg-orange-100 text-orange-600
                    {% else %}bg-gray-100 text-gray-600{% endif %}">
{{ result.icon if result.icon else '📄' }}
                </span>
            </div>

            <!-- Content using universal entity_link macro -->
            <div class="min-w-0 flex-1">
                {{ entity_link(result.model_type, result.id, result.title, mode='modal', subtitle=result.subtitle) }}
            </div>

            <!-- Type label -->
            <div class="flex-shrink-0">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium capitalize
                    {% if result.type == 'company' %}bg-blue-100 text-blue-800
                    {% elif result.type == 'contact' %}bg-green-100 text-green-800
                    {% elif result.type == 'opportunity' %}bg-purple-100 text-purple-800
                    {% elif result.type == 'task' %}bg-orange-100 text-orange-800
                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ result.type }}
                </span>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
    {% if query %}
    <div class="px-4 py-6 text-sm text-gray-500 text-center">
        <div class="text-gray-400 text-2xl mb-2">🔍</div>
        No results found for "{{ query }}"
    </div>
    {% else %}
    <div class="px-4 py-6 text-sm text-gray-500 text-center">
        <div class="text-gray-400 text-2xl mb-2">💡</div>
        Start typing to search companies, contacts, opportunities, and tasks
    </div>
    {% endif %}
{% endif %}