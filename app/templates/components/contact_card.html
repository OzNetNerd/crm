{% from "components/expandable_card.html" import expandable_card, action_buttons_row %}
{% from "components/ui_elements.html" import pluralized_count %}

{# Contact field configuration - clean, declarative setup #}
{% set contact_field_config = {
    'title_field': 'name',
    'secondary_fields': [
        {'field': 'role', 'type': 'text'}
    ],
    'metadata_fields': [
        {'field': 'created_at', 'type': 'date', 'format': '%m/%d/%y'}
    ]
} %}

{# Custom secondary info handler for contact company link #}
{% macro contact_secondary_info(contact) %}
{% if contact.role %}{{ contact.role }} â€¢ {% endif %}
<span class="text-link-interactive" 
      onclick="event.stopPropagation(); openCompanyDetailModal({{ contact.company.id }})">
    <span class="text-entity-base text-color-company">{{ contact.company.name }}</span>
</span>
{% endmacro %}

{% macro render_contact(contact) %}
{{ expandable_card('contact', contact, contact.id,
    expansion_enabled=true,
    field_config=contact_field_config,
    secondary_info=contact_secondary_info(contact),
    action_buttons=action_buttons_row('contact', contact.id)) }}
{% endmacro %}

{% macro contact_expanded_content(contact) %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Contact Details -->
    <div>
        <h4 class="text-sm font-medium text-gray-900 mb-2">Contact Details</h4>
        <div class="space-y-2 text-sm">
            {% if contact.email %}
                <div class="flex items-center">
                    {{ envelope_icon("w-4 h-4 text-gray-400 mr-2") }}
                    <a href="mailto:{{ contact.email }}" class="text-blue-600 hover:text-blue-800">
                        {{ contact.email }}
                    </a>
                </div>
            {% endif %}
            {% if contact.phone %}
                <div class="flex items-center">
                    {{ phone_icon("w-4 h-4 text-gray-400 mr-2") }}
                    <a href="tel:{{ contact.phone }}" class="text-green-600 hover:text-green-800">
                        {{ contact.phone }}
                    </a>
                </div>
            {% endif %}
            {% if not contact.email and not contact.phone %}
                <p class="text-gray-500 italic">No contact information available</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div>
        <h4 class="text-sm font-medium text-gray-900 mb-2">Quick Actions</h4>
        <div class="quick-actions-grid">
            <button @click.stop="createTask({{ contact.id }})" 
                    class="quick-action-btn quick-action-btn-primary">
                Add Task
            </button>
            <button @click.stop="createOpportunity({{ contact.id }})" 
                    class="quick-action-btn quick-action-btn-secondary">
                New Opportunity
            </button>
            {% if contact.opportunities %}
                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-md text-sm">
                    {{ pluralized_count(contact.opportunities|length, 'opportunity', short=true) }}
                </span>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}