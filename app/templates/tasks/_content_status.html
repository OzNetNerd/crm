{# Status-based Task Grouping - Server-side rendered with Alpine.js filtering #}
{% from "components/task_card.html" import render_task, render_task_hierarchy %}
{% from "components/ui_elements.html" import section_group_header %}
{% from "components/icons.html" import clipboard_list_icon, bolt_icon, check_circle_icon_solid %}

<div class="space-y-4">
    <!-- To Do Tasks -->
    <div class="card">
        {{ section_group_header('todo', 'To Do', clipboard_list_icon("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-blue" x-text="getTasksByStatus(\'todo\').length"></span>', 'blue', 'blue', 'blue', 'text-status-header') }}
        <div class="p-6" x-show="expandedSections['todo']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.status == 'todo' and task.task_type != 'child' %}
                    <div class="task-wrapper" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'todo') }}
                        {% else %}
                            {{ render_task(task, 'todo') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>

    <!-- In Progress Tasks -->
    <div class="card">
        {{ section_group_header('in-progress', 'In Progress', bolt_icon("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-yellow" x-text="getTasksByStatus(\'in-progress\').length"></span>', 'yellow', 'yellow', 'yellow', 'text-status-header') }}
        <div class="p-6" x-show="expandedSections['in-progress']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.status == 'in-progress' and task.task_type != 'child' %}
                    <div class="task-wrapper" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'in-progress') }}
                        {% else %}
                            {{ render_task(task, 'in-progress') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>

    <!-- Completed Tasks (conditional) -->
    <div x-show="showCompleted" class="card">
        {{ section_group_header('complete', 'Completed', check_circle_icon_solid("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-green" x-text="getTasksByStatus(\'complete\').length"></span>', 'green', 'green', 'green', 'text-status-header') }}
        <div class="p-6" x-show="expandedSections['complete']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.status == 'complete' and task.task_type != 'child' %}
                    <div class="task-wrapper opacity-60" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'complete') }}
                        {% else %}
                            {{ render_task(task, 'complete') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>
</div>