{# Priority-based Task Grouping - Server-side rendered with Alpine.js filtering #}
{% from "components/task_card.html" import render_task, render_task_hierarchy %}
{% from "components/ui_elements.html" import section_group_header %}
{% from "components/icons.html" import fire_icon_solid, exclamation_triangle_icon, clipboard_list_icon %}

<div class="space-y-4">
    <!-- High Priority -->
    <div class="card-danger">
        {{ section_group_header('high', 'High Priority', fire_icon_solid("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-red" x-text="getTasksByPriority(\'high\').length"></span>', 'red', 'red', 'red', 'text-status-overdue') }}
        <div class="p-6" x-show="expandedSections['high']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.priority == 'high' and task.task_type != 'child' %}
                    <div class="task-wrapper" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'high') }}
                        {% else %}
                            {{ render_task(task, 'high') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>

    <!-- Medium Priority -->
    <div class="card-warning">
        {{ section_group_header('medium', 'Medium Priority', exclamation_triangle_icon("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-yellow" x-text="getTasksByPriority(\'medium\').length"></span>', 'yellow', 'yellow', 'yellow', 'text-status-warning') }}
        <div class="p-6" x-show="expandedSections['medium']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.priority == 'medium' and task.task_type != 'child' %}
                    <div class="task-wrapper" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'medium') }}
                        {% else %}
                            {{ render_task(task, 'medium') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>

    <!-- Low Priority -->
    <div class="card-success">
        {{ section_group_header('low', 'Low Priority', clipboard_list_icon("w-5 h-5 mr-1"), '<span class="ml-2 badge-standard badge-green" x-text="getTasksByPriority(\'low\').length"></span>', 'green', 'green', 'green', 'text-status-success') }}
        <div class="p-6" x-show="expandedSections['low']" x-cloak x-transition>
            {% for task in tasks_objects %}
                {% if task.priority == 'low' and task.task_type != 'child' %}
                    <div class="task-wrapper" x-show="shouldShowTask({{ task.to_dict() | tojson | safe }})">
                        {% if task.task_type == 'parent' %}
                            {{ render_task_hierarchy(task, 'low') }}
                        {% else %}
                            {{ render_task(task, 'low') }}
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="text-empty-state">No matching tasks found</p>
            {% endfor %}
        </div>
    </div>
</div>