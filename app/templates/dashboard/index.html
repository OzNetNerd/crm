{% extends "base/layout.html" %}
{% from 'macros/components.html' import card %}
{% from 'macros/entities.html' import entity_card %}


{% block title %}Dashboard - CRM{% endblock %}

{% block content %}
<div class="container-content">
    <div class="section-spacing">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle">Overview of your CRM performance and activity</p>

        {# DRY: Use existing entity_types from backend #}
        {% if entity_types %}
        <div class="page-actions">
            {% for entity_type in entity_types %}
                <a href="/modals/{{ entity_type }}/create"
                   hx-get="/modals/{{ entity_type }}/create"
                   hx-target="#modal-container"
                   hx-swap="innerHTML"
                   class="btn btn-primary">
                    New {{ entity_type.title() }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="grid-responsive-2">
        {# DRY: Iterate over dashboard sections from backend #}
        {% for section in dashboard_sections %}
            {% call card(title=section.title) %}
                {% for entity in section.entities %}
                    {{ entity_card(entity, section.entity_type, config=section.display_config) }}
                {% endfor %}
            {% endcall %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block modals %}
<div id="modal-container"
     hx-target="this"
     hx-swap="innerHTML"
     role="dialog"
     aria-live="polite"
     aria-label="Modal dialogs"></div>
{% endblock %}

{% block scripts %}
{# Dashboard functionality now handled by HTML/CSS #}
{% endblock %}