{# Page Template - Unified layout system for consistent page structure #}

{% from "macros/ui/quick_actions.html" import entity_buttons %}
{% from 'macros/base/icons.html' import icon %}

{#
  Unified Page Layout - Single flexible macro for all page layouts
  
  Replaces page_layout, simple_page_header, and entity_page_layout with one DRY solution
  
  Parameters:
  - title (required): Page title text
  - subtitle (required): Page description text
  - buttons (optional): Array of button objects for entity_buttons macro
  - summary_data (optional): Dict with 'title' and 'stats' array for metric display
  - additional_header_content (optional): Extra content to display in header area
  - filter_content (optional): Custom filter content to include
  - entity_name (optional): Entity name for color theming
  - bulk_actions (optional): Bulk action buttons (disabled in current implementation)
  - header_only (optional): Only render header without content wrapper
  
  Usage:
  {% call page_layout("Companies", "Manage relationships", buttons=buttons, summary_data=stats, filter_content=filters) %}
    <!-- Page content -->
  {% endcall %}
  
  Header only: {{ page_layout("Title", "Subtitle", buttons=buttons, header_only=true) }}
#}
{% macro page_layout(title, subtitle, buttons=None, summary_data=None, additional_header_content=None, filter_content=None, entity_name=None, bulk_actions=None, header_only=false) %}
<!-- Professional Page Header -->
<div class="mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div class="flex-1">
            <h1 class="page-title">{{ title }}</h1>
            <p class="page-subtitle">{{ subtitle }}</p>
            {% if additional_header_content %}
            <div class="mt-4">{{ additional_header_content }}</div>
            {% endif %}
        </div>
        {% if buttons %}
        <div class="flex-shrink-0">
            <div class="flex flex-wrap gap-3">
                {{ entity_buttons(buttons) }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Bulk Actions Bar - Disabled (Alpine.js removed) -->
{% if bulk_actions %}
<!-- Bulk actions temporarily disabled during Alpine.js to HTMX conversion -->
{% endif %}

{% if not header_only %}
<!-- Professional Summary Section -->
{% if summary_data %}
<div class="mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
    <h2 class="section-title">{{ summary_data.title }}</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% for stat in summary_data.stats %}
        <div class="text-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
            <div class="text-2xl font-bold {{ ('text-status-' + stat.status) if stat.status else (('text-' + entity_name + '-600') if entity_name else 'text-gray-900') }} mb-1">
                {{ stat.value }}
            </div>
            <div class="text-sm text-gray-600">{{ stat.label }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Professional Filter Section -->
{% if filter_content %}
<div class="mb-6 p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
    {{ filter_content|safe }}
</div>
{% endif %}

<!-- Main Content Area -->
<div class="space-y-6">
    {{ caller() }}
</div>
{% endif %}
{% endmacro %}

{#
  Page Action Bar - Standalone action bar for complex pages
  
  Parameters:
  - primary_actions (optional): Primary action buttons
  - secondary_actions (optional): Secondary action buttons  
  - bulk_actions (optional): Bulk selection actions
  - view_controls (optional): View mode controls
  
  Usage:
  {{ page_action_bar(primary_actions=buttons, view_controls=view_toggles) }}
#}
{% macro page_action_bar(primary_actions=None, secondary_actions=None, bulk_actions=None, view_controls=None) %}
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <!-- Left Side - Bulk Actions - Disabled (Alpine.js removed) -->
    {% if bulk_actions %}
    <!-- Bulk actions temporarily disabled during Alpine.js to HTMX conversion -->
    {% endif %}
    
    <!-- Right Side - Actions and Controls -->
    <div class="flex items-center space-x-4">
        {% if view_controls %}
        {{ view_controls|safe }}
        {% endif %}
        
        {% if secondary_actions %}
        <div class="flex items-center space-x-2">
            {{ secondary_actions|safe }}
        </div>
        {% endif %}
        
        {% if primary_actions %}
        <div class="flex-shrink-0">
            {{ entity_buttons(primary_actions) }}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{#
  Navigation Link - DRY navigation link with active state

  Parameters:
  - endpoint (required): Flask endpoint name (e.g., 'companies.index')
  - text (required): Link text to display
  - endpoint_prefix (optional): Endpoint prefix for active state (defaults to endpoint prefix)

  Usage:
  {{ nav_link('companies.index', 'Companies') }}
  {{ nav_link('stakeholders.index', 'Stakeholders', 'stakeholders.') }}
#}
{% macro nav_link(endpoint, text, endpoint_prefix=None) %}
    {% set is_active = request.endpoint == endpoint %}
    <a href="{{ url_for(endpoint) }}"
       class="nav-link{% if is_active %} active{% endif %}">{{ text }}</a>
{% endmacro %}