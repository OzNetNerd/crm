{# Button Macros - Standardized button components for consistent interface #}
{% from "macros/base/icons.html" import icon %}

{#
  Unified Button - Semantic CSS button system using entity theming

  Clean button macro using semantic CSS classes instead of verbose Tailwind.
  Supports entity theming and proper semantic class structure.

  Parameters:
  - text (optional): Button text content (omit for icon-only buttons)
  - onclick (optional): JavaScript function call to execute on click
  - url (optional): URL for href (use instead of onclick for links)
  - icon (optional): Icon HTML from icon macros
  - style (optional): Button style ('primary', 'secondary', 'accent', 'danger', 'gray', 'outline', 'action') - default: 'primary'
  - size (optional): Button size ('sm', 'md', 'lg') - default: 'md'
  - disabled (optional): Whether button is disabled - default: false
  - id (optional): HTML id attribute
  - classes (optional): Additional CSS classes for custom styling
  - entity (optional): Entity type ('company', 'task', 'opportunity', etc.) - uses entity-specific colors

  Usage:
  {{ button('New Task', url='/modals/Task/create', icon=icon('plus', 'sm')) }}
  {{ button('New Company', style='primary', entity='company') }}
  {{ button(icon=icon('ellipsis-horizontal', 'sm'), onclick='openModal()', style='action', size='sm') }}
  {{ button('Edit', style='secondary', size='sm') }}
#}
{% macro button(text='', url=None, icon='', style='primary', size='md', disabled=false, id=None, entity='', action=None, data={}) %}

{# Build semantic CSS classes #}
{%- set button_classes = ['btn-base'] -%}

{# Add style class #}
{% if entity and style == 'primary' %}
  {# Use entity-specific button class for primary buttons #}
  {% do button_classes.append('btn-' + entity) %}
{% else %}
  {# Use semantic style class #}
  {% do button_classes.append('btn-' + style) %}
{% endif %}

{# Add size class #}
{% do button_classes.append('btn-' + size) %}

{# Add disabled class if needed #}
{% if disabled %}
  {% do button_classes.append('disabled') %}
{% endif %}

{# Join all classes #}
{%- set final_classes = button_classes | join(' ') -%}

{% if url %}
<a href="{{ url }}"
   class="{{ final_classes }}"
   {% if id %}id="{{ id }}"{% endif %}
   {% if disabled %}aria-disabled="true"{% endif %}>
    {{ icon|safe }}{% if text and icon %} {% endif %}{{ text }}
</a>
{% else %}
<button class="{{ final_classes }}"
        {% if id %}id="{{ id }}"{% endif %}
        {% if disabled %}disabled{% endif %}
        {% if action %}data-action="{{ action }}"{% endif %}
        {% for key, value in data.items() %}data-{{ key }}="{{ value }}"{% endfor %}
        type="button">
    {{ icon|safe }}{% if text and icon %} {% endif %}{{ text }}
</button>
{% endif %}
{% endmacro %}

{#
  Action Button Set - Standardized group of action buttons with consistent styling
  
  Creates a set of action buttons using the standardized styling patterns from 
  the expandable card system. Provides consistent hover effects and spacing.
  
  Parameters:
  - buttons (required): Array of button configurations
  - container_classes (optional): Additional CSS classes for container
  
  Button Configuration:
  {
    'type': 'edit' | 'delete' | 'complete' | 'custom',
    'onclick': 'javascript_function_call',
    'hx_get': '/endpoint' (for HTMX GET),
    'hx_post': '/endpoint' (for HTMX POST), 
    'hx_delete': '/endpoint' (for HTMX DELETE),
    'hx_target': 'selector',
    'hx_swap': 'strategy',
    'hx_confirm': 'confirmation_message',
    'title': 'tooltip_text',
    'icon': 'icon_html',
    'classes': 'additional_css_classes'
  }
  
  Usage:
  {{ action_button_set([
      {'type': 'edit', 'hx_get': '/modals/Task/123/edit', 'hx_target': 'body'},
      {'type': 'delete', 'hx_delete': '/api/tasks/123', 'hx_confirm': 'Are you sure?'}
  ]) }}
#}
{% macro action_button_set(buttons, container_classes='flex items-center space-x-1') %}
{% from "macros/base/icons.html" import pencil_icon, trash_icon, check_icon %}

{%- set default_configs = {
    'edit': {
        'icon': icon('pencil', 'sm'),
        'title': 'Edit',
        'classes': 'text-blue-600 hover:text-blue-800 hover:bg-blue-50'
    },
    'delete': {
        'icon': icon('trash', 'sm'), 
        'title': 'Delete',
        'classes': 'text-red-600 hover:text-red-800 hover:bg-red-50'
    },
    'complete': {
        'icon': icon('check', 'sm'),
        'title': 'Complete',
        'classes': 'text-green-600 hover:text-green-800 hover:bg-green-50'
    }
} -%}

<div class="{{ container_classes }}">
    {% for button in buttons %}
    {%- set config = default_configs.get(button.type, {}) -%}
    <button onclick="event.stopPropagation(){% if button.onclick %}; {{ button.onclick }}{% endif %}"
            {% if button.hx_get %}hx-get="{{ button.hx_get }}"{% endif %}
            {% if button.hx_post %}hx-post="{{ button.hx_post }}"{% endif %}
            {% if button.hx_delete %}hx-delete="{{ button.hx_delete }}"{% endif %}
            {% if button.hx_target %}hx-target="{{ button.hx_target }}"{% endif %}
            {% if button.hx_swap %}hx-swap="{{ button.hx_swap }}"{% endif %}
            {% if button.hx_confirm %}hx-confirm="{{ button.hx_confirm }}"{% endif %}
            class="px-2 py-1 rounded text-sm transition-colors duration-200 {{ button.get('classes', config.get('classes', 'text-gray-400 hover:text-gray-600')) }}"
            title="{{ button.get('title', config.get('title', button.type.title())) }}">
        {{ button.get('icon', config.get('icon', ''))|safe }}
    </button>
    {% endfor %}
</div>
{% endmacro %}

{#
  Universal Entity Link - DRY solution for all entity linking across the app

  Supports both navigation and modal modes. Follows ADR-014 DRY patterns.
  Eliminates duplication between search results, tables, cards, etc.

  Parameters:
  - entity_type (required): Type of entity ('company', 'contact', 'opportunity', 'task')
  - entity_id (required): ID of the entity
  - text (required): Link text to display
  - mode (optional): 'navigate' for standard links, 'modal' for modal opening (default: 'navigate')
  - subtitle (optional): Additional text to display below main text
  - classes (optional): Additional CSS classes

  Usage:
  {{ entity_link('company', 123, 'Acme Corp', mode='modal') }}
  {{ entity_link('task', 456, 'Review proposal', mode='navigate') }}
  {{ entity_link('contact', 789, 'John Doe', subtitle='CEO at Acme Corp', mode='modal') }}
#}
{% macro entity_link(entity_type, entity_id, text, mode='navigate', subtitle='', classes='') %}
{% if mode == 'modal' %}
<a href="#"
   onclick="window.dispatchEvent(new CustomEvent('open-detail-{{ entity_type }}-modal', { detail: { id: {{ entity_id }}, readOnly: true } })); return false;"
   class="group block hover:bg-blue-50 transition-colors duration-150 {{ classes }}"
   data-entity-type="{{ entity_type }}"
   data-entity-id="{{ entity_id }}">
    <div class="text-sm font-semibold text-gray-900 truncate group-hover:text-blue-700 transition-colors">
        {{ text }}
    </div>
    {% if subtitle %}
    <div class="text-xs text-gray-500 truncate mt-1">
        {{ subtitle }}
    </div>
    {% endif %}
</a>
{% else %}
<a href="/{{ entity_type }}s/{{ entity_id }}" class="{{ classes }}">
    {{ text }}
    {% if subtitle %}
    <div class="text-xs text-gray-500 truncate mt-1">
        {{ subtitle }}
    </div>
    {% endif %}
</a>
{% endif %}
{% endmacro %}

{#
  Entity Link Button - Standardized link button for entity details

  Parameters:
  - url (required): URL to link to
  - text (optional): Button text (default: 'View Details')
  - classes (optional): Additional CSS classes

  Usage:
  {{ entity_link_button(url_for('companies.detail', id=company.id)) }}
  {{ entity_link_button('/stakeholders/123', 'View Stakeholder') }}
#}
{% macro entity_link_button(url, text='View Details', classes='mt-3 block w-full text-center px-4 py-2 text-sm font-medium text-green-600 bg-white border border-green-600 rounded-md hover:bg-green-600 hover:text-white transition-all duration-200') %}
<a href="{{ url }}" class="{{ classes }}">{{ text }}</a>
{% endmacro %}