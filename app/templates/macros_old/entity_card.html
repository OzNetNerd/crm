{# Simple, DRY entity card template for all entities #}
{% from "macros/base/icons.html" import icon %}
{% from "macros/base/forms.html" import bulk_selection_checkbox %}

{% macro entity_card(entity, entity_type) %}
<div class="card-{{ entity_type }} entity-card"
     data-entity-card
     data-entity-type="{{ entity_type }}"
     data-entity-id="{{ entity.id }}">
  <div class="entity-card-content">
    {{ bulk_selection_checkbox(entity.id) }}

    {# Entity content - name, status, etc. #}
    <div class="flex-1">
      {# Render entity-specific content based on type #}
      {% if entity_type == 'task' %}
        <span class="font-medium">{{ entity.description }}</span>
        {% if entity.priority %}
          <span class="ml-2 px-2 py-1 text-xs rounded-full bg-{{ 'red' if entity.priority == 'high' else 'yellow' if entity.priority == 'medium' else 'gray' }}-100 text-{{ 'red' if entity.priority == 'high' else 'yellow' if entity.priority == 'medium' else 'gray' }}-800">
            {{ entity.priority }}
          </span>
        {% endif %}
      {% elif entity_type == 'company' %}
        <span class="font-medium">{{ entity.name }}</span>
        {% if entity.size %}
          <span class="ml-2 text-sm text-gray-600">{{ entity.size }}</span>
        {% endif %}
      {% elif entity_type == 'contact' %}
        <span class="font-medium">{{ entity.first_name }} {{ entity.last_name }}</span>
        {% if entity.email %}
          <span class="ml-2 text-sm text-gray-600">{{ entity.email }}</span>
        {% endif %}
      {% elif entity_type == 'deal' %}
        <span class="font-medium">{{ entity.name }}</span>
        {% if entity.value %}
          <span class="ml-2 text-sm font-semibold text-green-600">${{ "{:,.2f}".format(entity.value) }}</span>
        {% endif %}
      {% elif entity_type == 'interaction' %}
        <span class="font-medium">{{ entity.type }}</span>
        <span class="ml-2 text-sm text-gray-600">{{ entity.description[:50] }}{% if entity.description|length > 50 %}...{% endif %}</span>
      {% else %}
        {# Fallback for any other entity type #}
        <span class="font-medium">{{ entity.name if entity.name is defined else entity.title if entity.title is defined else entity.description if entity.description is defined else 'Entity #' ~ entity.id }}</span>
      {% endif %}
    </div>
  </div>

  {# Action buttons - always on the right #}
  <div class="entity-card-actions">
    {# Complete button for tasks only - now on the right #}
    {% if entity_type == 'task' and entity.status != 'complete' %}
      <button data-action="complete"
              data-entity-type="{{ entity_type }}"
              data-entity-id="{{ entity.id }}"
              class="btn-icon btn-complete"
              title="Mark complete">
        {{ icon('check-circle', 'sm') }}
      </button>
    {% endif %}
    <button data-action="edit"
            data-entity-type="{{ entity_type }}"
            data-entity-id="{{ entity.id }}"
            class="btn-icon btn-edit"
            title="Edit">
      {{ icon('pencil', 'sm') }}
    </button>
    <button data-action="delete"
            data-entity-type="{{ entity_type }}"
            data-entity-id="{{ entity.id }}"
            class="btn-icon btn-delete"
            title="Delete">
      {{ icon('trash', 'sm') }}
    </button>
  </div>
</div>
{% endmacro %}

{# JavaScript moved to /static/js/features/entity-actions.js #}