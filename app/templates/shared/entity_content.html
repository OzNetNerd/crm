{# Universal HTMX Content Partial - Works for ALL entities using simple entity card #}
{% from "macros/entities.html" import entity_card %}
{% from 'macros/ui.html' import icon, empty_state, badge %}

{# Pure CSS/HTML version - no Alpine.js needed #}
<div class="space-y-4" x-data="{ selected_items: [] }">

    {# Show total count #}
    {% if total_count > 0 and grouped_entities|length > 0 %}
        <div class="text-sm text-gray-600 mb-4">
            Showing {{ total_count }} {{ entity_name_singular if total_count == 1 else entity_name }}
        </div>
    {% endif %}

    {# Render grouped entities using card macro and details/summary #}
    {% for group in grouped_entities %}
        <details class="card" data-group="{{ group.key }}" open>
            <summary class="card-header cursor-pointer list-none">
                <div class="flex items-center justify-between">
                    <h3 class="font-medium text-gray-900 flex items-center">
                        <span class="mr-2 text-gray-400 hover:text-gray-600 transition-transform duration-200 details-chevron">
                            {{ icon('chevron-right') }}
                        </span>
                        {{ group.label }}
                        <span class="badge badge-info badge-sm ml-2">
                            {{ group.count }}
                        </span>
                    </h3>
                </div>
            </summary>
            
            {# Group Content #}
            <div>
                
                {% for entity in group.entities %}
                    {# Render all entities with the simple entity card #}
                    {% if entity.task_type is not defined or entity.task_type != 'child' %}
                        {{ entity_card(entity, entity_type) }}
                    {% endif %}
                {% endfor %}
                
                {% if group.entities|length == 0 %}
                    {{ group_empty_state(entity_name_plural, group.label) }}
                {% endif %}
            </div>
        </details>
    {% endfor %}

    {# No results message - using DRY empty state component #}
    {% if grouped_entities|length == 0 %}
        {{ empty_state(model_class.get_entity_config()) }}
    {% endif %}

</div>

<style>
/* CSS for details chevron rotation in entity groups */
details[data-group] summary::-webkit-details-marker {
    display: none;
}
details[data-group][open] .details-chevron {
    transform: rotate(90deg);
}
</style>