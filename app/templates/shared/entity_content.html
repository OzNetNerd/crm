{# Universal HTMX Content Partial - Works for ALL entities using simple entity card #}
{% from "macros/entities.html" import entity_card %}
{% from 'macros/ui.html' import icon, empty_state, badge %}

{# Pure CSS/HTML version - no Alpine.js needed #}
<div class="space-y-4" x-data="{ selected_items: [] }">

    {# Show total count #}
    {% if total_count > 0 and grouped_entities|length > 0 %}
        <div class="text-sm text-gray-600 mb-4">
            Showing {{ total_count }} {{ entity_name_singular if total_count == 1 else entity_name }}
        </div>
    {% endif %}

    {# Render grouped entities using card macro and details/summary #}
    {% for group in grouped_entities %}
        <details class="card" data-group="{{ group.key }}" open>
            <summary class="entity-group-summary">
                <div class="entity-group-header">
                    <h3 class="entity-group-title">
                        <span class="entity-group-chevron">
                            {{ icon('chevron-right') }}
                        </span>
                        {{ group.label }}
                        <span class="badge badge-info badge-sm ml-2">
                            {{ group.count }}
                        </span>
                    </h3>
                </div>
            </summary>
            
            {# Group Content #}
            <div class="card-body">
                
                {% for entity in group.entities %}
                    {# Render all entities with the simple entity card #}
                    {% if entity.task_type is not defined or entity.task_type != 'child' %}
                        {{ entity_card(entity, entity_type) }}
                    {% endif %}
                {% endfor %}
                
                {% if group.entities|length == 0 %}
                    <p class="text-gray-500 text-center py-4">No {{ entity_name|lower }} in {{ group.label }}</p>
                {% endif %}
            </div>
        </details>
    {% endfor %}

    {# No results message #}
    {% if grouped_entities|length == 0 %}
        <p class="text-gray-500 text-center py-8">No {{ entity_name|lower }} found</p>
    {% endif %}

</div>

<style>
/* CSS for details chevron rotation in entity groups */
details[data-group] summary::-webkit-details-marker {
    display: none;
}
details[data-group][open] .details-chevron {
    transform: rotate(90deg);
}
</style>