{#
  Modern Card System - Clean, modular architecture
  
  Clean card system with proper separation of concerns:
  - Container: Layout and structure
  - Content: Entity-specific data rendering  
  - Builders: Content configuration generation
  
  Usage:
  {% from "macros/cards.html" import card %}
  
  {{ card(task) }}
  {{ card(company, expansion_enabled=false) }}
  {{ card(opportunity, overrides={'actions': custom_actions}) }}
#}

{# Import core card system components #}
{% from "macros/cards/container.html" import card_container, simple_card_container %}
{% from "macros/cards/content_renderers.html" import render_content_section, render_action_section, render_field %}

{#
  Card - Main entry point for the card system
  
  Parameters:
  - entity (required): Entity data object (automatically extracts type)
  - expansion_enabled (optional): Allow expand/collapse (default: true)
  - card_classes (optional): Additional CSS classes
  - content (optional): Custom content configuration
  - overrides (optional): Override specific content sections
  
  Examples:
  {{ card(task) }}
  {{ card(company, expansion_enabled=false) }}
  {{ card(stakeholder, overrides={'actions': custom_actions}) }}
#}
{% macro card(entity, expansion_enabled=true, card_classes='', content=none, overrides={}) %}
{# Self-contained - get what we need directly from entity #}
{% set entity_type = entity.__class__.__name__.lower() %}
{% set entity_name_plural = entity.__class__.get_display_name_plural() %}

{% if content is none %}
    {% set content = build_dynamic_card_config(entity_name_plural.lower(), entity) %}
    
    {# Apply overrides #}
    {% for section, override_config in overrides.items() %}
        {% do content.update({section: override_config}) %}
    {% endfor %}
{% endif %}

{{ card_container(entity_type, entity.id, expansion_enabled, card_classes, content) }}
{% endmacro %}

{#
  Simple Card - Non-expandable card variant

  Parameters:
  - entity (required): Entity data object
  - card_classes (optional): Additional CSS classes
  - content (optional): Custom content configuration
  - overrides (optional): Override specific content sections
#}
{% macro simple_card(entity, card_classes='', content=none, overrides={}) %}
{{ card(entity, expansion_enabled=false, card_classes=card_classes, content=content, overrides=overrides) }}
{% endmacro %}

{#
  Dashboard Card - Dashboard-style card with consistent styling

  Uses the existing entity_card_item system for DRY implementation.
  Automatically determines entity type and applies proper data hierarchy.

  Parameters:
  - entity (required): Entity data object
  - card_classes (optional): Additional CSS classes

  Examples:
  {{ dashboard_card(company) }}
  {{ dashboard_card(opportunity) }}
  {{ dashboard_card(stakeholder) }}
#}
{% macro dashboard_card(entity, card_classes='') %}
{% from "macros/ui/card_items.html" import entity_card_item %}
{# Get entity type from class name #}
{% set entity_type = entity.__class__.__name__.lower() %}
{{ entity_card_item(entity, entity_type) }}
{% endmacro %}