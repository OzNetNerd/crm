{# Flexible Metric Card Macro #}

{# Color theme mapping for consistent styling #}
{% set color_themes = {
  'blue': {
    'bg': 'bg-blue-100',
    'text': 'text-blue-600'
  },
  'green': {
    'bg': 'bg-green-100', 
    'text': 'text-green-600'
  },
  'yellow': {
    'bg': 'bg-yellow-100',
    'text': 'text-yellow-600'  
  },
  'purple': {
    'bg': 'bg-purple-100',
    'text': 'text-purple-600'
  },
  'red': {
    'bg': 'bg-red-100',
    'text': 'text-red-600'
  },
  'gray': {
    'bg': 'bg-gray-100',
    'text': 'text-gray-600'
  }
} %}

{# 
  Metric Card Macro
  
  Parameters:
  - title (required): The metric title/label
  - value (required): The metric value (number, text, or HTML)
  - icon_macro (required): Icon macro call (e.g., building_office_icon())
  - color_theme (optional): Color theme - blue, green, yellow, purple, red, gray (default: blue)
  - href (optional): URL to make the card clickable
  - additional_classes (optional): Extra CSS classes for the container
  - icon_size (optional): Icon size classes (default: w-5 h-5)
#}
{% macro metric_card(title, value, icon_macro, color_theme='blue', href=None, additional_classes='', icon_size='w-5 h-5') %}
  {% set theme = color_themes.get(color_theme, color_themes['blue']) %}
  {% set container_tag = 'a' if href else 'div' %}
  {% set container_attrs = 'href="' + href + '"' if href else '' %}
  {% set hover_classes = 'hover:shadow-md transition-shadow cursor-pointer' if href else '' %}
  
  <{{ container_tag }} {{ container_attrs|safe }} class="card-padded-lg {{ hover_classes }} {{ additional_classes }}">
    <div class="flex items-center">
      <div class="flex-shrink-0">
        <div class="w-8 h-8 {{ theme.bg }} rounded-lg flex items-center justify-center {{ theme.text }}">
          {{ icon_macro|replace('w-5 h-5', icon_size) }}
        </div>
      </div>
      <div class="ml-5 w-0 flex-1">
        <dl>
          <dt class="text-metric-heading">{{ title }}</dt>
          <dd class="text-metric-value">{{ value }}</dd>
        </dl>
      </div>
    </div>
  </{{ container_tag }}>
{% endmacro %}

{#
  Simple Metric Card - Simplified version for basic use cases
  
  Parameters:
  - title, value, icon_macro (required)
  - color (optional): blue, green, yellow, purple (default: blue)
#}
{% macro simple_metric_card(title, value, icon_macro, color='blue') %}
  {{ metric_card(title, value, icon_macro, color) }}
{% endmacro %}

{# 
  Stat Card Macro - Centered number/text layout (no icon)
  
  Parameters:
  - label (required): Bottom text label  
  - value (required): Large number/text to display
  - color_theme (optional): Color theme - red, orange, blue, green, purple, yellow, gray (default: gray)
  - href (optional): URL to make the card clickable
  - additional_classes (optional): Extra CSS classes for the container
#}
{% macro stat_card(label, value, color_theme='gray', href=None, additional_classes='') %}
  {% set theme = color_themes.get(color_theme, color_themes['gray']) %}
  {% set container_tag = 'a' if href else 'div' %}
  {% set container_attrs = 'href="' + href + '"' if href else '' %}
  {% set hover_classes = 'hover:shadow-md transition-shadow cursor-pointer' if href else '' %}
  
  {# Map color themes to text colors for large numbers #}
  {% set text_colors = {
    'red': 'text-red-600',
    'orange': 'text-orange-600', 
    'blue': 'text-blue-600',
    'green': 'text-green-600',
    'purple': 'text-purple-600',
    'yellow': 'text-yellow-600',
    'gray': 'text-gray-600'
  } %}
  {% set value_color = text_colors.get(color_theme, 'text-gray-600') %}
  
  <{{ container_tag }} {{ container_attrs|safe }} class="card-padded-lg {{ hover_classes }} {{ additional_classes }}">
    <div class="text-center">
      <div class="text-3xl font-bold {{ value_color }}">{{ value }}</div>
      <div class="text-metric-heading">{{ label }}</div>
    </div>
  </{{ container_tag }}>
{% endmacro %}

{#
  Simple Stat Card - Simplified version for basic use cases
  
  Parameters:
  - label, value (required)
  - color (optional): red, orange, blue, green (default: gray)
#}
{% macro simple_stat_card(label, value, color='gray') %}
  {{ stat_card(label, value, color) }}
{% endmacro %}

{# 
  Overview Section Macro - Flexible multi-stat overview with header
  
  Parameters:
  - title (required): Section heading (e.g., "Sales Pipeline")
  - summary_text (optional): Right-aligned summary info 
  - stats (required): List of {value, value_color, label} objects (any length)
  - additional_classes (optional): Extra container classes
  
  Example:
  {% set my_stats = [
    {value: '$50K', value_color: 'green', label: 'Prospect'},
    {value: '$75K', value_color: 'blue', label: 'Qualified'}
  ] %}
  {{ overview_section('Sales Pipeline', 'Total: $125K', my_stats) }}
#}
{% macro overview_section(title, summary_text=None, stats=[], additional_classes='mb-8') %}
  {# Dynamic grid sizing based on stats count #}
  {% set stats_count = stats|length %}
  {% if stats_count <= 2 %}
    {% set grid_classes = 'grid-cols-' + stats_count|string %}
  {% elif stats_count == 3 %}
    {% set grid_classes = 'grid-cols-3' %}
  {% elif stats_count == 4 %}
    {% set grid_classes = 'grid-cols-2 md:grid-cols-4' %}
  {% elif stats_count == 5 %}
    {% set grid_classes = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-5' %}
  {% else %}
    {% set grid_classes = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-6' %}
  {% endif %}
  
  {# Map value_color to text classes (reuse existing color system) #}
  {% set text_colors = {
    'red': 'text-red-600',
    'orange': 'text-orange-600', 
    'blue': 'text-blue-600',
    'green': 'text-green-600',
    'purple': 'text-purple-600',
    'yellow': 'text-yellow-600',
    'gray': 'text-gray-600'
  } %}
  
  <div class="card-padded-lg {{ additional_classes }}">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-section-title">{{ title }}</h2>
      {% if summary_text %}
        <div class="text-secondary">{{ summary_text }}</div>
      {% endif %}
    </div>
    <div class="grid {{ grid_classes }} gap-4">
      {% for stat in stats %}
        {% set color_class = text_colors.get(stat.value_color, 'text-gray-600') %}
        <div class="text-center">
          <div class="text-2xl font-bold {{ color_class }}">{{ stat.value }}</div>
          <div class="text-metric-heading">{{ stat.label }}</div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endmacro %}

{#
  Simple Overview Section - Simplified version for basic use cases
  
  Parameters:
  - title (required): Section heading
  - stats (required): List of {value, value_color, label} objects
#}
{% macro simple_overview_section(title, stats) %}
  {{ overview_section(title, None, stats) }}
{% endmacro %}