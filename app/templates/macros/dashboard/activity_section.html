{% from "macros/ui/list_section.html" import list_section, simple_list_item, alert_list_item, note_list_item %}
{% from "macros/ui/metadata_display.html" import task_metadata %}
{% from "macros/base/icons.html" import icon %}

{% macro dashboard_alerts_section(overdue_tasks, closing_soon) %}
{# Dashboard-specific critical alerts section #}
<div class="space-y-6">
    <!-- Overdue Tasks Alert -->
    {% if overdue_tasks %}
    {% call list_section('Overdue Tasks', href='/tasks/', theme_color='red', icon_macro=icon('exclamation-circle-solid', 'md', 'c-icon--danger')) %}
        {% for task in overdue_tasks %}
            {{ alert_list_item(
                title=task.description,
                warning_text=task_metadata(task),
                warning_color='red',
                action_href='/tasks/'
            ) }}
        {% endfor %}
    {% endcall %}
    {% endif %}

    <!-- Closing Soon Opportunities -->
    {% if closing_soon %}
    {% call list_section('Closing Soon', href='/opportunities/', theme_color='yellow', icon_macro=icon('calendar-days', 'md', 'c-icon--warning')) %}
        {% for opp in closing_soon %}
            {{ alert_list_item(
                title=opp.name,
                warning_text=opp.value_formatted + ' • ' + opp.expected_close_date_formatted,
                warning_color='yellow',
                action_href='/opportunities/'
            ) }}
        {% endfor %}
    {% endcall %}
    {% endif %}
</div>
{% endmacro %}

{% macro dashboard_recent_activity_section(recent_tasks, recent_opportunities, recent_notes) %}
{# Dashboard-specific recent activity section #}
<div class="space-y-6">
    <!-- Recent Tasks -->
    {% call list_section('Recent Tasks', href='/tasks/') %}
        {% for task in recent_tasks %}
            {{ simple_list_item(
                title=task.description,
                subtitle=task_metadata(task),
                badge_text=task.priority|title,
                badge_color='badge-' + task.priority
            ) }}
        {% endfor %}
    {% endcall %}

    <!-- Recent Opportunities -->
    {% call list_section('Recent Opportunities', href='/opportunities/') %}
        {% for opp in recent_opportunities %}
            {{ simple_list_item(
                title='<span class="text-opportunity">' + opp.name + '</span>',
                subtitle='<span class="text-company">' + opp.company_name + '</span> • <span class="text-deal">' + opp.value_formatted + '</span>',
                badge_text=opp.stage|title,
                badge_color='badge-' + opp.stage
            ) }}
        {% endfor %}
    {% endcall %}

    <!-- Recent Notes -->
    {% call list_section('Recent Notes') %}
        {% for note in recent_notes %}
            {{ note_list_item(
                content=note.content,
                metadata=note.created_at_formatted + ((' • ' + note.entity_name) if note.entity_name else ''),
                accent_color='blue'
            ) }}
        {% endfor %}
    {% endcall %}
</div>
{% endmacro %}