{# Simple, DRY entity card template for all entities #}
{% from "macros/base/icons.html" import icon %}
{% from "macros/base/forms.html" import bulk_selection_checkbox %}

{% macro entity_card(entity, entity_type) %}
<div class="card-{{ entity_type }} flex items-center justify-between p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow">
  <div class="flex items-center space-x-3">
    {{ bulk_selection_checkbox(entity.id) }}

    {# Complete button for tasks only - goes on the left #}
    {% if entity_type == 'task' and entity.status != 'complete' %}
      <button onclick="completeTask({{ entity.id }})"
              class="text-green-600 hover:text-green-800 transition-colors"
              title="Mark complete">
        {{ icon('check-circle', 'sm') }}
      </button>
    {% endif %}

    {# Entity content - name, status, etc. #}
    <div class="flex-1">
      {# Render entity-specific content based on type #}
      {% if entity_type == 'task' %}
        <span class="font-medium">{{ entity.description }}</span>
        {% if entity.priority %}
          <span class="ml-2 px-2 py-1 text-xs rounded-full bg-{{ 'red' if entity.priority == 'high' else 'yellow' if entity.priority == 'medium' else 'gray' }}-100 text-{{ 'red' if entity.priority == 'high' else 'yellow' if entity.priority == 'medium' else 'gray' }}-800">
            {{ entity.priority }}
          </span>
        {% endif %}
      {% elif entity_type == 'company' %}
        <span class="font-medium">{{ entity.name }}</span>
        {% if entity.size %}
          <span class="ml-2 text-sm text-gray-600">{{ entity.size }}</span>
        {% endif %}
      {% elif entity_type == 'contact' %}
        <span class="font-medium">{{ entity.first_name }} {{ entity.last_name }}</span>
        {% if entity.email %}
          <span class="ml-2 text-sm text-gray-600">{{ entity.email }}</span>
        {% endif %}
      {% elif entity_type == 'deal' %}
        <span class="font-medium">{{ entity.name }}</span>
        {% if entity.value %}
          <span class="ml-2 text-sm font-semibold text-green-600">${{ "{:,.2f}".format(entity.value) }}</span>
        {% endif %}
      {% elif entity_type == 'interaction' %}
        <span class="font-medium">{{ entity.type }}</span>
        <span class="ml-2 text-sm text-gray-600">{{ entity.description[:50] }}{% if entity.description|length > 50 %}...{% endif %}</span>
      {% else %}
        {# Fallback for any other entity type #}
        <span class="font-medium">{{ entity.name if entity.name is defined else entity.title if entity.title is defined else entity.description if entity.description is defined else 'Entity #' ~ entity.id }}</span>
      {% endif %}
    </div>
  </div>

  {# Action buttons - always on the right #}
  <div class="flex items-center space-x-2">
    <button onclick="window.dispatchEvent(new CustomEvent('open-detail-{{ entity_type }}-modal', { detail: { id: {{ entity.id }}, readOnly: true } }))"
            class="text-gray-600 hover:text-gray-800 transition-colors"
            title="View">
      {{ icon('eye', 'sm') }}
    </button>
    <button onclick="window.dispatchEvent(new CustomEvent('open-detail-{{ entity_type }}-modal', { detail: { id: {{ entity.id }} } }))"
            class="text-blue-600 hover:text-blue-800 transition-colors"
            title="Edit">
      {{ icon('pencil', 'sm') }}
    </button>
    <button onclick="if(confirm('Are you sure you want to delete this {{ entity_type }}?')) { deleteEntity('{{ entity_type }}', {{ entity.id }}) }"
            class="text-red-600 hover:text-red-800 transition-colors"
            title="Delete">
      {{ icon('trash', 'sm') }}
    </button>
  </div>
</div>
{% endmacro %}

{# JavaScript function for completing tasks #}
<script>
function completeTask(taskId) {
  fetch(`/dashboard/tasks/${taskId}/complete`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => {
    if (response.ok) {
      // Reload the content area to show updated task
      location.reload();
    }
  });
}

function deleteEntity(entityType, entityId) {
  fetch(`/api/entities/${entityType}/${entityId}`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => {
    if (response.ok) {
      // Reload the content area to show updated list
      location.reload();
    }
  });
}
</script>