{#
    Components Macros - Basic UI components
    Contains only essential, non-duplicate macros
#}

{% from 'macros/ui.html' import icon %}

{# ============================================
   BASIC CONFIRMATION MODAL
   ============================================ #}
{% macro confirmation_modal(title, message, action_url, action_text='Delete', action_class='btn-danger') %}
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{{ title }}</h3>
                <button type="button" class="modal-close" onclick="closeModal('confirmation-modal')">
                    {{ icon('x-mark') }}
                </button>
            </div>
            <div class="modal-body">
                <p>{{ message }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('confirmation-modal')">Cancel</button>
                <form method="POST" action="{{ action_url }}" style="display: inline;">
                    <button type="submit" class="btn {{ action_class }}">{{ action_text }}</button>
                </form>
            </div>
        </div>
    </div>
{% endmacro %}

{# ============================================
   BASIC CARD LAYOUT
   ============================================ #}
{% macro card(title='', class='', body_class='') %}
    <div class="card {{ class }}">
        {% if title %}
            <div class="card-header">
                <h3 class="card-title">{{ title }}</h3>
            </div>
        {% endif %}
        <div class="card-body {{ body_class }}">
            {{ caller() }}
        </div>
    </div>
{% endmacro %}

{# ============================================
   GENERIC DROPDOWN (for action menus, not search)
   ============================================ #}
{% macro dropdown(id, trigger_text='Options', items=[], align='left') %}
    <div class="dropdown" data-dropdown-id="{{ id }}">
        <button class="dropdown-trigger" data-dropdown-id="{{ id }}">
            {{ trigger_text }}
            {{ icon('chevron-down') }}
        </button>
        <div id="{{ id }}" class="dropdown-menu dropdown-menu-{{ align }}">
            {% for item in items %}
                {% if item.divider %}
                    <div class="dropdown-divider"></div>
                {% else %}
                    <a href="{{ item.url or '#' }}"
                       class="dropdown-item{% if item.danger %} dropdown-item-danger{% endif %}"
                       {% if item.action %}data-action="{{ item.action }}"{% endif %}>
                        {% if item.icon %}{{ icon(item.icon) }}{% endif %}
                        {{ item.text }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endmacro %}

{# ============================================
   SEARCH WIDGET - GOLD STANDARD FOR ALL SEARCH
   ============================================ #}
{% macro search_widget(placeholder='Search...', id='search', mode='modal') %}
    <div class="relative">
        <input type="text"
               id="{{ id }}"
               name="q"
               class="search-input w-48 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{{ placeholder }}"
               autocomplete="off"
               hx-get="{{ url_for('search.htmx_search') }}"
               hx-trigger="focus, input changed delay:300ms"
               hx-target="#{{ id }}-results"
               hx-include="this"
               hx-vals='{"mode": "{{ mode }}"}'>
        <button class="absolute right-2 top-2 text-gray-400 hover:text-gray-600">
            {{ icon('magnifying-glass') }}
        </button>
        <div id="{{ id }}-results" class="search-dropdown-results absolute top-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg hidden z-50"></div>
    </div>
{% endmacro %}

{# ============================================
   UNIFIED SEARCH FIELD - FOR FORMS WITH DYNAMIC SEARCH
   ============================================ #}
{% macro entity_search_dropdown(name, entity_type, value='', search_value='', label='', required=false, placeholder='Search...') %}
    {% if label %}
        <label for="{{ name }}_search" class="form-label{% if required %} form-label-required{% endif %}">
            {{ label }}
        </label>
    {% endif %}
    <div class="relative">
        <input type="text"
               id="{{ name }}_search"
               name="q"
               class="search-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{{ placeholder }}"
               value="{{ search_value }}"
               autocomplete="off"
               hx-get="{{ url_for('search.htmx_search') }}"
               hx-trigger="focus, input changed delay:300ms"
               hx-target="#{{ name }}_search-results"
               hx-swap="innerHTML"
               hx-include="this"
               hx-vals='{"mode": "select", "type": "{{ entity_type }}", "field_name": "{{ name }}"}'>
        <input type="hidden" name="{{ name }}" id="{{ name }}" value="{{ value }}"{% if required %} required{% endif %}>
        <div id="{{ name }}_search-results" class="absolute top-full mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto hidden z-50"></div>
    </div>
{% endmacro %}

{% macro choice_search_dropdown(name, choices, value='', search_value='', label='', required=false, placeholder='Search...') %}
    {{ entity_search_dropdown(name, 'choice:' + name, value, search_value, label, required, placeholder) }}
{% endmacro %}

{# ============================================
   ENTITY DROPDOWN CONTROLS - Placeholder for missing macro
   ============================================ #}
{% macro entity_dropdown_controls(dropdowns=[], entity_type='') %}
    {# Placeholder for entity dropdown controls - implement as needed #}
{% endmacro %}
