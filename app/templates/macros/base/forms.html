{% macro text_input(name, label, model_var, placeholder="", required=false, type="text") %}
<div class="form-field">
    <label class="form-label{% if required %} form-label-required{% endif %}">{{ label }}</label>
    <input type="{{ type }}" 
           x-model="{{ model_var }}" 
           placeholder="{{ placeholder }}"
           class="form-input"
           {% if required %}required{% endif %}>
</div>
{% endmacro %}

{% macro textarea_input(name, label, model_var, placeholder="", rows=2, required=false) %}
<div class="form-field">
    <label class="form-label{% if required %} form-label-required{% endif %}">{{ label }}</label>
    <textarea x-model="{{ model_var }}" 
              placeholder="{{ placeholder }}"
              class="form-textarea"
              rows="{{ rows }}"
              {% if required %}required{% endif %}></textarea>
</div>
{% endmacro %}

{% macro select_input(name, label, model_var, options, required=false, empty_option="") %}
<div class="form-field">
    <label class="form-label{% if required %} form-label-required{% endif %}">{{ label }}</label>
    <select x-model="{{ model_var }}" 
            class="form-select"
            {% if required %}required{% endif %}>
        {% if empty_option %}
        <option value="">{{ empty_option }}</option>
        {% endif %}
        {% for option in options %}
            {% if option is mapping %}
                <option value="{{ option.value }}">{{ option.label }}</option>
            {% else %}
                <option value="{{ option }}">{{ option|title }}</option>
            {% endif %}
        {% endfor %}
    </select>
</div>
{% endmacro %}

{% macro date_input(name, label, model_var, required=false) %}
<div class="form-field">
    <label class="form-label{% if required %} form-label-required{% endif %}">{{ label }}</label>
    <input type="date" 
           x-model="{{ model_var }}" 
           class="form-input"
           {% if required %}required{% endif %}>
</div>
{% endmacro %}

{% macro email_input(name, label, model_var, placeholder="email@example.com", required=false) %}
{{ text_input(name, label, model_var, placeholder, required, "email") }}
{% endmacro %}

{% macro tel_input(name, label, model_var, placeholder="Phone number", required=false) %}
{{ text_input(name, label, model_var, placeholder, required, "tel") }}
{% endmacro %}

{% macro url_input(name, label, model_var, placeholder="https://example.com", required=false) %}
{{ text_input(name, label, model_var, placeholder, required, "url") }}
{% endmacro %}

{% macro grid_2_columns(left_content, right_content) %}
<div class="grid grid-cols-2 gap-4">
    <div>{{ left_content }}</div>
    <div>{{ right_content }}</div>
</div>
{% endmacro %}

{% macro form_section(title, content) %}
{% if title %}
<div class="space-y-5">
    <h4 class="text-md font-semibold text-gray-900 pb-2 border-b border-gray-100">{{ title }}</h4>
    {{ content }}
</div>
{% else %}
<div class="space-y-5">
    {{ content }}
</div>
{% endif %}
{% endmacro %}

{% macro radio_group(name, label, model_var, options, required=false) %}
<div class="form-field">
    <label class="form-label{% if required %} form-label-required{% endif %}">{{ label }}</label>
    <div class="modal-radio-group">
        {% for option in options %}
        <label class="modal-radio-label">
            <input type="radio" x-model="{{ model_var }}" value="{{ option.value if option is mapping else option }}" 
                   class="form-radio"
                   {% if required %}required{% endif %}>
            <span class="modal-radio-text">{{ option.label if option is mapping else option|title }}</span>
        </label>
        {% endfor %}
    </div>
</div>
{% endmacro %}

{# Enhanced form components for selection and search #}
{% from 'macros/base/icons.html' import icon %}

{#
  Bulk Selection Checkbox - Checkbox with consistent selection styling
  
  Parameters:
  - item_id (required): Unique identifier for the item
  - model (optional): Alpine.js model name (default: 'selectedItems')
  - additional_classes (optional): Extra CSS classes
  
  Usage:
  {{ bulk_selection_checkbox(company.id) }}
  {{ bulk_selection_checkbox(contact.id, 'selectedStakeholders') }}
#}
{% macro bulk_selection_checkbox(item_id, model='selected_items', additional_classes='') %}
<input type="checkbox" 
       name="{{ model }}" 
       value="{{ item_id }}"
       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded {{ additional_classes }}"
       onclick="event.stopPropagation()">
{% endmacro %}

{#
  Select All Checkbox - Master checkbox for bulk selection
  
  Parameters:
  - total_items (required): Total number of items that can be selected
  - model (optional): Alpine.js model name (default: 'selectedItems')
  - label (optional): Label text for the checkbox
  
  Usage:
  {{ select_all_checkbox(companies|length) }}
  {{ select_all_checkbox(contacts|length, 'selectedStakeholders', 'Select all contacts') }}
#}
{% macro select_all_checkbox(total_items, model='selectedItems', label='Select all') %}
<label class="flex items-center space-x-2">
    <input type="checkbox"
           :checked="{{ model }}.length === {{ total_items }} && {{ total_items }} > 0"
           :indeterminate="{{ model }}.length > 0 && {{ model }}.length < {{ total_items }}"
           @change="{{ model }} = $event.target.checked ? allItemIds : []"
           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
    <span class="text-sm text-gray-700">{{ label }}</span>
</label>
{% endmacro %}

{#
  Search Input - Consistent search input with icon
  
  Parameters:
  - placeholder (optional): Placeholder text
  - model (optional): Alpine.js model binding
  - additional_classes (optional): Extra CSS classes
  
  Usage:
  {{ search_input('Search companies...', 'searchTerm') }}
#}
{% macro search_input(placeholder='Search...', model='searchTerm', additional_classes='') %}
<div class="relative">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        {{ icon('magnifying-glass', 'md', 'text-gray-400') }}
    </div>
    <input type="text" 
           x-model="{{ model }}"
           class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm {{ additional_classes }}"
           placeholder="{{ placeholder }}">
    <div x-show="{{ model }}.length > 0" class="absolute inset-y-0 right-0 pr-3 flex items-center">
        <button @click="{{ model }} = ''" class="text-gray-400 hover:text-gray-600">
            {{ icon('x-mark', 'sm') }}
        </button>
    </div>
</div>
{% endmacro %}

{#
  Child Task Form - Reusable WTForms-based component for multi-task creation
  
  Parameters:
  - child_form (required): WTForms ChildTaskForm instance
  - task_number (required): Display number (1-based) for user interface
  - visible_class (optional): CSS class for visibility control (default: '')
  
  Usage:
  {{ child_task_form(form.child_tasks[0], 1) }}
  {{ child_task_form(form.child_tasks[2], 3, 'hidden') }}
#}
{% macro child_task_form(child_form, task_number, visible_class='') %}
<div class="child-task border border-gray-200 rounded-lg p-4 bg-gray-50 {{ visible_class }}">
    <div class="flex justify-between items-start mb-3">
        <h4 class="text-md font-medium text-gray-900">Child Task {{ task_number }}</h4>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-2">
            {{ child_form.description.label(class="block text-sm font-medium text-gray-700") }}
            {{ child_form.description(class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500", rows="2") }}
            {% if child_form.description.errors %}
                <div class="mt-1 text-sm text-red-600">
                    {% for error in child_form.description.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div>
            {{ child_form.priority.label(class="block text-sm font-medium text-gray-700") }}
            {{ child_form.priority(class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500") }}
            {% if child_form.priority.errors %}
                <div class="mt-1 text-sm text-red-600">
                    {% for error in child_form.priority.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div>
            {{ child_form.due_date.label(class="block text-sm font-medium text-gray-700") }}
            {{ child_form.due_date(class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500") }}
            {% if child_form.due_date.errors %}
                <div class="mt-1 text-sm text-red-600">
                    {% for error in child_form.due_date.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div>
            {{ child_form.next_step_type.label(class="block text-sm font-medium text-gray-700") }}
            {{ child_form.next_step_type(class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500") }}
            {% if child_form.next_step_type.errors %}
                <div class="mt-1 text-sm text-red-600">
                    {% for error in child_form.next_step_type.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}