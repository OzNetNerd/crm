{# Base Form Components - Only used macros #}

{% macro bulk_selection_checkbox(item_id, model='selected_items', additional_classes='') %}
<input type="checkbox"
       :checked="{{ model }}.includes('{{ item_id }}')"
       @change="{{ model }}.includes('{{ item_id }}') ? {{ model }} = {{ model }}.filter(id => id !== '{{ item_id }}') : {{ model }}.push('{{ item_id }}')"
       class="form-checkbox {{ additional_classes }}">
{% endmacro %}

{% macro select_all_checkbox(items, model='selectedItems', label='Select all') %}
<label class="flex items-center">
    <input type="checkbox"
           :checked="{{ model }}.length === {{ items|length }}"
           @change="{{ model }} = $event.target.checked ? {{ items|tojson|safe }}.map(item => item.id) : []"
           class="form-checkbox">
    <span class="select-all-label">{{ label }}</span>
</label>
{% endmacro %}

{% macro search_input(placeholder='Search...', model='searchTerm', additional_classes='') %}
<input type="text"
       x-model="{{ model }}"
       placeholder="{{ placeholder }}"
       class="form-input {{ additional_classes }}">
{% endmacro %}

{# WTForms Field Rendering Macro #}
{% macro render_wtforms_field(field, fast_select=false, model_name=None) %}
    <div class="field-container">
        <!-- Label -->
        <label for="{{ field.id }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ field.label.text }}
            {% if field.flags.required %}
            <span class="text-red-500">*</span>
            {% endif %}
        </label>

        <!-- Field Rendering based on field type -->
        {% set error_class = " error" if field.errors else "" %}

        {% if field.type == 'SelectField' %}
            {{ field(class="form-select" + error_class) }}

        {% elif field.type == 'TextAreaField' %}
            {{ field(class="form-textarea" + error_class, rows=field.render_kw.get('rows', 3) if field.render_kw else 3) }}

        {% elif field.type == 'BooleanField' %}
            <div class="form-checkbox-wrapper">
                {{ field(class="form-checkbox") }}
                <span class="form-checkbox-label">{{ field.description or field.label.text }}</span>
            </div>

        {% elif field.type == 'DateField' %}
            {{ field(class="form-input" + error_class, type="date") }}

        {% elif field.type == 'DateTimeField' %}
            {{ field(class="form-input" + error_class, type="datetime-local") }}

        {% elif field.type == 'SearchField' or (field.render_kw and field.render_kw.get('data-searchable')) %}
            <div class="searchable-field-wrapper">
                {{ field(class="form-input searchable-input" + error_class,
                        **{'data-searchable': field.render_kw.get('data-searchable', model_name),
                           'autocomplete': 'off'}) }}
                <div class="search-results"></div>
            </div>

        {% else %}
            {# Default text input for StringField, IntegerField, etc. #}
            {{ field(class="form-input" + error_class) }}
        {% endif %}

        <!-- Error Messages -->
        {% if field.errors %}
        <div class="field-errors mt-1">
            {% for error in field.errors %}
            <p class="text-sm text-red-600">{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
    </div>
{% endmacro %}