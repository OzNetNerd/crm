{# Page Template - Unified layout system for consistent page structure #}

{% from "macros/quick_actions.html" import quick_actions_buttons %}

{#
  Page Layout Macro - Standardized page structure with consistent header, summary, and content areas
  
  Parameters:
  - title (required): Page title text (e.g., "Companies", "Tasks")
  - subtitle (required): Page description text (e.g., "Manage your company relationships")
  - buttons (optional): Array of button objects for quick_actions_buttons macro
  - summary_data (optional): Dict with 'title' and 'stats' array for metric display
  - additional_header_content (optional): Extra content to display in header area
  - with_filters (optional): Include space for filter controls
  - filter_content (optional): Custom filter content to include
  
  Usage:
  {% call page_layout("Companies", "Manage your company relationships", buttons=company_buttons, summary_data=company_stats, with_filters=true) %}
    <!-- Page-specific content goes here -->
  {% endcall %}
#}
{% macro page_layout(title, subtitle, buttons=None, summary_data=None, additional_header_content=None, with_filters=false, filter_content=None) %}
<!-- Standardized Page Header -->
<div class="mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
        <h1 class="text-page-title">{{ title }}</h1>
        <p class="text-secondary-dark">{{ subtitle }}</p>
        {% if additional_header_content %}{{ additional_header_content }}{% endif %}
    </div>
    {% if buttons %}
    <div class="flex-shrink-0">
        {{ quick_actions_buttons(buttons) }}
    </div>
    {% endif %}
</div>

<!-- Optional Summary Section -->
{% if summary_data %}
<div class="mb-8 card-padded-lg">
    <h2 class="text-section-title mb-4">{{ summary_data.title }}</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 items-center min-h-[80px]">
        {% for stat in summary_data.stats %}
        <div class="text-center flex flex-col justify-center">
            <div class="text-2xl font-bold {{ stat.color_class or 'text-gray-900' }}">
                {{ stat.value }}
            </div>
            <div class="text-secondary">{{ stat.label }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Optional Filter Section -->
{% if with_filters or filter_content %}
<div class="mb-6">
    {% if filter_content %}
        {{ filter_content|safe }}
    {% else %}
        <!-- Default filter placeholder -->
        <div class="card-padded">
            <div class="text-secondary-dark text-sm">Filter controls would go here</div>
        </div>
    {% endif %}
</div>
{% endif %}

<!-- Main Content Area -->
<div class="space-y-6">
    {{ caller() }}
</div>
{% endmacro %}

{#
  Simple Page Header - For pages that only need header without summary
  
  Parameters:
  - title (required): Page title
  - subtitle (required): Page description  
  - buttons (optional): Button array for actions
#}
{% macro simple_page_header(title, subtitle, buttons=None) %}
<div class="mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
        <h1 class="text-page-title">{{ title }}</h1>
        <p class="text-secondary-dark">{{ subtitle }}</p>
    </div>
    {% if buttons %}
    <div class="flex-shrink-0">
        {{ quick_actions_buttons(buttons) }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{#
  Entity Page Layout - Enhanced layout specifically for entity index pages
  
  Provides all the features needed for modern entity pages with filtering,
  view modes, and consistent structure.
  
  Parameters:
  - title (required): Page title
  - subtitle (required): Page description
  - entity_type (required): Type of entity (for Alpine.js data)
  - buttons (optional): Action buttons
  - summary_data (optional): Summary statistics
  - filter_controls (optional): Custom filter control HTML
  - bulk_actions (optional): Bulk action buttons
  
  Usage:
  {% call entity_page_layout("Companies", "Manage relationships", "companies", 
       buttons=buttons, summary_data=stats, filter_controls=filters) %}
    <!-- Entity display content -->
  {% endcall %}
#}
{% macro entity_page_layout(title, subtitle, entity_type, buttons=None, summary_data=None, filter_controls=None, bulk_actions=None) %}
<!-- Enhanced Page Header with Bulk Actions -->
<div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
        <div>
            <h1 class="text-page-title">{{ title }}</h1>
            <p class="text-secondary-dark">{{ subtitle }}</p>
        </div>
        {% if buttons %}
        <div class="flex-shrink-0">
            {{ quick_actions_buttons(buttons) }}
        </div>
        {% endif %}
    </div>
    
    <!-- Bulk Actions Bar -->
    {% if bulk_actions %}
    <div x-show="selectedItems.length > 0" 
         x-cloak 
         x-transition
         class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <span class="text-blue-800 font-medium" x-text="`${selectedItems.length} items selected`"></span>
            {{ bulk_actions|safe }}
        </div>
        <button @click="selectedItems = []" class="text-blue-600 hover:text-blue-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
    {% endif %}
</div>

<!-- Summary Section -->
{% if summary_data %}
<div class="mb-8 card-padded-lg">
    <h2 class="text-section-title mb-4">{{ summary_data.title }}</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 items-center min-h-[80px]">
        {% for stat in summary_data.stats %}
        <div class="text-center flex flex-col justify-center">
            <div class="text-2xl font-bold {{ stat.color_class or 'text-gray-900' }}">
                {{ stat.value }}
            </div>
            <div class="text-secondary">{{ stat.label }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Filter Controls Section -->
{% if filter_controls %}
{{ filter_controls|safe }}
{% endif %}

<!-- Main Content Area -->
<div class="space-y-6">
    {{ caller() }}
</div>
{% endmacro %}

{#
  Page Action Bar - Standalone action bar for complex pages
  
  Parameters:
  - primary_actions (optional): Primary action buttons
  - secondary_actions (optional): Secondary action buttons  
  - bulk_actions (optional): Bulk selection actions
  - view_controls (optional): View mode controls
  
  Usage:
  {{ page_action_bar(primary_actions=buttons, view_controls=view_toggles) }}
#}
{% macro page_action_bar(primary_actions=None, secondary_actions=None, bulk_actions=None, view_controls=None) %}
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <!-- Left Side - Bulk Actions -->
    {% if bulk_actions %}
    <div x-show="selectedItems.length > 0" 
         x-cloak 
         x-transition
         class="flex items-center space-x-4">
        <span class="text-sm font-medium text-gray-700" x-text="`${selectedItems.length} selected`"></span>
        {{ bulk_actions|safe }}
    </div>
    {% endif %}
    
    <!-- Right Side - Actions and Controls -->
    <div class="flex items-center space-x-4">
        {% if view_controls %}
        {{ view_controls|safe }}
        {% endif %}
        
        {% if secondary_actions %}
        <div class="flex items-center space-x-2">
            {{ secondary_actions|safe }}
        </div>
        {% endif %}
        
        {% if primary_actions %}
        <div class="flex-shrink-0">
            {{ quick_actions_buttons(primary_actions) }}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}