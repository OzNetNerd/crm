{# Page Template - Unified layout system for consistent page structure #}

{% from "macros/ui/quick_actions.html" import entity_buttons %}
{% from 'macros/base/icons.html' import icon %}

{#
  Unified Page Layout - Single flexible macro for all page layouts
  
  Replaces page_layout, simple_page_header, and entity_page_layout with one DRY solution
  
  Parameters:
  - title (required): Page title text
  - subtitle (required): Page description text
  - buttons (optional): Array of button objects for entity_buttons macro
  - summary_data (optional): Dict with 'title' and 'stats' array for metric display
  - additional_header_content (optional): Extra content to display in header area
  - filter_content (optional): Custom filter content to include
  - entity_name (optional): Entity name for color theming
  - bulk_actions (optional): Bulk action buttons (disabled in current implementation)
  - header_only (optional): Only render header without content wrapper
  
  Usage:
  {% call page_layout("Companies", "Manage relationships", buttons=buttons, summary_data=stats, filter_content=filters) %}
    <!-- Page content -->
  {% endcall %}
  
  Header only: {{ page_layout("Title", "Subtitle", buttons=buttons, header_only=true) }}
#}
{% macro page_layout(title, subtitle, buttons=None, summary_data=None, additional_header_content=None, filter_content=None, entity_name=None, bulk_actions=None, header_only=false) %}
<!-- Modern Page Header with Gradient Background -->
<div class="relative mb-8 p-8 rounded-2xl bg-gradient-to-br from-white via-gray-50 to-blue-50 border border-white/50 backdrop-blur-xl shadow-xl overflow-hidden">
    <!-- Subtle background pattern -->
    <div class="absolute inset-0 opacity-20">
        <div class="absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-full blur-xl"></div>
        <div class="absolute bottom-0 right-0 w-24 h-24 bg-gradient-to-tl from-green-500/20 to-blue-500/20 rounded-full blur-xl"></div>
    </div>

    <div class="relative z-10 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        <div class="flex-1">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-gray-900 via-blue-800 to-gray-900 bg-clip-text text-transparent mb-3">
                {{ title }}
            </h1>
            <p class="text-lg text-gray-600 font-medium">{{ subtitle }}</p>
            {% if additional_header_content %}
            <div class="mt-4">{{ additional_header_content }}</div>
            {% endif %}
        </div>
        {% if buttons %}
        <div class="flex-shrink-0">
            <div class="flex flex-wrap gap-3">
                {{ entity_buttons(buttons) }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Bulk Actions Bar - Disabled (Alpine.js removed) -->
{% if bulk_actions %}
<!-- Bulk actions temporarily disabled during Alpine.js to HTMX conversion -->
{% endif %}

{% if not header_only %}
<!-- Modern Summary Section -->
{% if summary_data %}
<div class="mb-8 p-6 bg-gradient-to-r from-white via-blue-50 to-white rounded-2xl border border-white/50 backdrop-blur-xl shadow-lg">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">{{ summary_data.title }}</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        {% for stat in summary_data.stats %}
        <div class="text-center p-4 bg-white/70 backdrop-blur-sm rounded-xl border border-white/30 hover:bg-white/90 transition-all duration-300 hover:scale-105">
            <div class="text-3xl font-bold {{ ('text-' + entity_name + '-600') if entity_name else 'text-blue-600' }} mb-2">
                {{ stat.value }}
            </div>
            <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider">{{ stat.label }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Modern Filter Section -->
{% if filter_content %}
<div class="mb-8 p-6 bg-white/80 backdrop-blur-sm rounded-xl border border-white/50 shadow-md">
    {{ filter_content|safe }}
</div>
{% endif %}

<!-- Main Content Area with Modern Styling -->
<div class="space-y-8">
    {{ caller() }}
</div>
{% endif %}
{% endmacro %}

{#
  Page Action Bar - Standalone action bar for complex pages
  
  Parameters:
  - primary_actions (optional): Primary action buttons
  - secondary_actions (optional): Secondary action buttons  
  - bulk_actions (optional): Bulk selection actions
  - view_controls (optional): View mode controls
  
  Usage:
  {{ page_action_bar(primary_actions=buttons, view_controls=view_toggles) }}
#}
{% macro page_action_bar(primary_actions=None, secondary_actions=None, bulk_actions=None, view_controls=None) %}
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <!-- Left Side - Bulk Actions - Disabled (Alpine.js removed) -->
    {% if bulk_actions %}
    <!-- Bulk actions temporarily disabled during Alpine.js to HTMX conversion -->
    {% endif %}
    
    <!-- Right Side - Actions and Controls -->
    <div class="flex items-center space-x-4">
        {% if view_controls %}
        {{ view_controls|safe }}
        {% endif %}
        
        {% if secondary_actions %}
        <div class="flex items-center space-x-2">
            {{ secondary_actions|safe }}
        </div>
        {% endif %}
        
        {% if primary_actions %}
        <div class="flex-shrink-0">
            {{ entity_buttons(primary_actions) }}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{#
  Navigation Link - DRY navigation link with active state

  Parameters:
  - endpoint (required): Flask endpoint name (e.g., 'companies.index')
  - text (required): Link text to display
  - endpoint_prefix (optional): Endpoint prefix for active state (defaults to endpoint prefix)

  Usage:
  {{ nav_link('companies.index', 'Companies') }}
  {{ nav_link('stakeholders.index', 'Stakeholders', 'stakeholders.') }}
#}
{% macro nav_link(endpoint, text, endpoint_prefix=None) %}
    {% set prefix = endpoint_prefix or (endpoint.split('.')[0] + '.') %}
    {% set is_active = request.endpoint and request.endpoint.startswith(prefix) %}
    <a href="{{ url_for(endpoint) }}"
       class="nav-link{% if is_active %} active{% endif %}">{{ text }}</a>
{% endmacro %}