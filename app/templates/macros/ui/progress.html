{#
  Progress Bar Component - DRY implementation for task completion and opportunity probability
  
  Parameters:
  - progress_type (required): 'completion' | 'probability' | 'custom'
  - value (required): Progress value (0-100 for percentage, or custom scale)
  - max_value (optional): Maximum value (default: 100)
  - color_scheme (optional): 'blue' | 'green' | 'yellow' | 'red' (default: 'blue')
  - show_text (optional): Display percentage text (default: true)
  - size (optional): 'sm' | 'md' | 'lg' (default: 'md')
  - label (optional): Text label to display before progress
  - additional_classes (optional): Extra CSS classes
  
  Usage:
  {{ progress_bar('completion', task.completion_percentage, label='Tasks') }}
  {{ progress_bar('probability', opportunity.probability, color_scheme='green') }}
  {{ progress_bar('custom', current_value, max_value=total_value, show_text=false) }}
#}
{% macro progress_bar(progress_type, value, max_value=100, color_scheme='blue', show_text=true, size='md', label='', additional_classes='') %}
{%- set percentage = (value / max_value * 100)|round|int if max_value > 0 else 0 -%}
{%- set size_classes = {
    'sm': {'bar': 'h-1.5', 'container': 'w-12', 'text': 'text-xs'},
    'md': {'bar': 'h-2', 'container': 'w-16', 'text': 'text-sm'},
    'lg': {'bar': 'h-3', 'container': 'w-20', 'text': 'text-base'}
} -%}
{%- set current_size = size_classes[size] or size_classes['md'] -%}

<div class="flex items-center space-x-2 {{ additional_classes }}">
    {% if label %}
    <span class="text-label-primary">{{ label }}:</span>
    {% endif %}
    
    {% if progress_type == 'completion' %}
    <span class="text-label-primary">{{ value }}/{{ max_value }}</span>
    {% endif %}
    
    <div class="flex items-center space-x-2">
        <div class="{{ current_size.container }} bg-gray-200 rounded-full {{ current_size.bar }}">
            <div class="bg-{{ color_scheme }}-600 {{ current_size.bar }} rounded-full transition-all duration-300" 
                 style="width: {{ percentage }}%"></div>
        </div>
        
        {% if show_text %}
        <span class="text-label-primary {{ current_size.text }}">{{ percentage }}%</span>
        {% endif %}
    </div>
</div>
{% endmacro %}

{#
  Task Progress Bar - Specialized macro for parent task completion
  
  Parameters:
  - task (required): Task object with child_tasks and completion_percentage
  - show_count (optional): Show completed/total count (default: true)
  
  Usage:
  {{ task_progress_bar(task) }}
  {{ task_progress_bar(task, show_count=false) }}
#}
{% macro task_progress_bar(task, show_count=true) %}
{%- set completed_count = task.child_tasks | selectattr('status', 'equalto', 'complete') | list | length -%}
{%- set total_count = task.child_tasks | length -%}
{{ progress_bar('completion', completed_count, max_value=total_count, 
                 color_scheme='blue', label='Tasks' if show_count else '') }}
{% endmacro %}

{#
  Opportunity Progress Bar - Specialized macro for opportunity probability
  
  Parameters:
  - opportunity (required): Opportunity object with probability
  - show_label (optional): Show "Probability" label (default: false)
  
  Usage:
  {{ opportunity_progress_bar(opportunity) }}
  {{ opportunity_progress_bar(opportunity, show_label=true) }}
#}
{% macro opportunity_progress_bar(opportunity, show_label=false) %}
{% if opportunity.probability %}
{{ progress_bar('probability', opportunity.probability, 
                 color_scheme='blue', label='Probability' if show_label else '', 
                 size='md') }}
{% endif %}
{% endmacro %}