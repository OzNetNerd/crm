{#
  Card Container System - Modern container-based architecture
  
  Provides the core card container with composable content sections.
  Replaces the monolithic expandable_card.html approach with focused components.
#}

{% from 'macros/base/icons.html' import icon %}
{% from "macros/base/forms.html" import bulk_selection_checkbox %}
{% from "macros/cards/content_renderers.html" import render_content_section, render_action_section %}

{#
  Universal Card Container - The foundation of the modern card system
  
  Parameters:
  - card_type (required): Entity type for styling and data attributes
  - entity_id (required): Unique identifier
  - expansion_enabled (optional): Allow expand/collapse (default: true)
  - card_classes (optional): Additional CSS classes
  - content (required): Content object with sections
  
  Content Object Structure:
  {
    'header': { /* header content config */ },
    'body': { /* body content config */ },
    'actions': { /* action buttons config */ },
    'footer': { /* footer content config */ },
    'expanded': { /* expanded content config */ }
  }
#}
{% macro card_container(card_type, entity_id, expansion_enabled=true, card_classes='', content={}) %}
{%- set base_classes = card_type + '-card card-padded relative mb-3' -%}
{%- set color_classes = {
    'task': 'ring-2 ring-gray-200 bg-gray-50',
    'opportunity': 'ring-2 ring-blue-200 bg-blue-50', 
    'contact': 'ring-2 ring-green-200 bg-green-50',
    'stakeholder': 'ring-2 ring-green-200 bg-green-50',
    'company': 'ring-2 ring-blue-200 bg-blue-50'
} -%}

{% if expansion_enabled %}
<details class="{{ base_classes }} {{ color_classes.get(card_type, 'ring-2 ring-gray-200 bg-gray-50') }} {{ card_classes }}" 
         data-{{ card_type }}-id="{{ entity_id }}">
    <summary class="cursor-pointer list-none flex items-center justify-between">
        <div class="flex-1 flex items-center justify-between">
            <!-- Header content -->
            <div class="flex items-center space-x-3">
                {% if content.get('bulk_selection', true) %}
                {{ bulk_selection_checkbox(entity_id) }}
                {% endif %}
                
                {% if content.header %}
                {{ render_content_section(content.header) }}
                {% endif %}
            </div>
            
            <!-- Action buttons and chevron grouped together -->
            <div class="flex items-center space-x-2">
                {% if content.actions %}
                {{ render_action_section(content.actions) }}
                {% endif %}
                
                <!-- Expand chevron -->
                <div class="transition-transform duration-200 details-chevron">
                    {{ icon('chevron-down', 'md', 'text-gray-400') }}
                </div>
            </div>
        </div>
    </summary>
    
    <!-- Expanded content -->
    <div class="mt-4 pt-4 border-t border-gray-200">
        {% if content.body %}
        {{ render_content_section(content.body) }}
        {% endif %}
        
        {% if content.expanded %}
        {{ render_content_section(content.expanded) }}
        {% endif %}
        
        {% if content.footer %}
        {{ render_content_section(content.footer) }}
        {% endif %}
    </div>
</details>
{% else %}
<!-- Non-expandable card -->
<div class="{{ base_classes }} {{ color_classes.get(card_type, 'ring-2 ring-gray-200 bg-gray-50') }} {{ card_classes }}" 
     data-{{ card_type }}-id="{{ entity_id }}">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
            {% if content.get('bulk_selection', false) %}
            {{ bulk_selection_checkbox(entity_id) }}
            {% endif %}
            
            {% if content.header %}
            {{ render_content_section(content.header) }}
            {% endif %}
        </div>
        
        {% if content.actions %}
        <div class="flex items-center space-x-2">
            {{ render_action_section(content.actions) }}
        </div>
        {% endif %}
    </div>
    
    {% if content.body %}
    <div class="mt-4 pt-4 border-t border-gray-200">
        {{ render_content_section(content.body) }}
    </div>
    {% endif %}
</div>
{% endif %}
{% endmacro %}

{#
  Simple Card Container - For static content without expansion
  
  Parameters:
  - card_type (required): Entity type for styling
  - entity_id (required): Unique identifier  
  - card_classes (optional): Additional CSS classes
  - content (required): Content object
#}
{% macro simple_card_container(card_type, entity_id, card_classes='', content={}) %}
{{ card_container(card_type, entity_id, expansion_enabled=false, card_classes=card_classes, content=content) }}
{% endmacro %}